[0m00:07:16.312480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D0A6AAE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D0B42B820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D0B429420>]}


============================== 00:07:16.316981 | 8cf6de56-992e-4f6c-8d8d-95de8282b2f8 ==============================
[0m00:07:16.316981 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:07:16.317981 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'debug': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m00:07:17.738985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D0B0E3F70>]}
[0m00:07:17.809486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2C014A30>]}
[0m00:07:17.811486 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m00:07:18.225487 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m00:07:18.226987 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:07:18.227986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2C213B80>]}
[0m00:07:19.930491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2D811E70>]}
[0m00:07:20.040491 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:07:20.044492 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:07:20.081492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2D86B8E0>]}
[0m00:07:20.081992 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m00:07:20.082992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8cf6de56-992e-4f6c-8d8d-95de8282b2f8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2D812EC0>]}
[0m00:07:20.084492 [info ] [MainThread]: 
[0m00:07:20.085493 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:07:20.085992 [info ] [MainThread]: 
[0m00:07:20.086493 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:07:20.093491 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:07:20.272992 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:07:20.273992 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:07:20.274492 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:07:21.107292 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:07:21.107792 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:07:21.108293 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_schemas
[0m00:07:21.108795 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:07:21.109795 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:07:21.110296 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m00:07:21.110795 [debug] [MainThread]: On list_dbt_hol_2025_dev: No close available on handle
[0m00:07:21.111294 [info ] [MainThread]: 
[0m00:07:21.111794 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.02 seconds (1.02s).
[0m00:07:21.112794 [error] [MainThread]: Encountered an error:
Runtime Error
  Database error while listing schemas in database "dbt_hol_2025_dev"
  Database Error
    250003 (08001): 404 Not Found: post https://gtb80691.us-east-1.snowflakecomputing.com:443/session/v1/login-request?request_id=3e3aab99-f41a-4401-bf66-1c1a21fa73c1&databaseName=dbt_hol_2025_dev&schemaName=public&warehouse=vwh_dbt_hol_dev&roleName=dbt_hol_role_dev&request_guid=3e1f10bf-e5f0-4640-bc37-8682b1963790
[0m00:07:21.114794 [debug] [MainThread]: Command `dbt seed` failed at 00:07:21.114794 after 4.91 seconds
[0m00:07:21.115295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D0A6AAE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2D811E70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000022D2C6A8400>]}
[0m00:07:21.115795 [debug] [MainThread]: Flushing usage events
[0m00:07:21.441268 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:39:03.058713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F6906EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F768B8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F7689120>]}


============================== 00:39:03.062238 | c65317a0-3b15-4ad5-b114-df9de4bb294f ==============================
[0m00:39:03.062238 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:39:03.063214 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt seed', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m00:39:04.088216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F7370700>]}
[0m00:39:04.157717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F73AFE20>]}
[0m00:39:04.159219 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m00:39:04.554718 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m00:39:04.740717 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m00:39:04.741717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F733D300>]}
[0m00:39:06.239223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A899D51B40>]}
[0m00:39:06.435225 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:39:06.438225 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:39:06.463724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A898A61960>]}
[0m00:39:06.464223 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m00:39:06.465224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c65317a0-3b15-4ad5-b114-df9de4bb294f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A89897A620>]}
[0m00:39:06.466723 [info ] [MainThread]: 
[0m00:39:06.467224 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:39:06.468224 [info ] [MainThread]: 
[0m00:39:06.468724 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:39:06.474724 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:39:06.615224 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:39:06.616225 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:39:06.616727 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:39:07.314828 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.698 seconds
[0m00:39:07.317330 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_dev, now create_dbt_hol_2025_dev_public)
[0m00:39:07.317828 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_dev"
schema: "public"
"
[0m00:39:07.322828 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_dev_public"
[0m00:39:07.323328 [debug] [ThreadPool]: On create_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "create_dbt_hol_2025_dev_public"} */
create schema if not exists dbt_hol_2025_dev.public
[0m00:39:07.564170 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb857-020d-08de-000d-306b000424c2
[0m00:39:07.564670 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 003041 (42710): SQL compilation error:
Schema 'PUBLIC' already exists, but current role has no privileges on it. If this is unexpected and you cannot resolve this problem, contact your system administrator. ACCOUNTADMIN role may be required to manage the privileges on the object.
[0m00:39:07.565671 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro create_schema
[0m00:39:07.566168 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:39:07.567169 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:39:07.568168 [debug] [MainThread]: Connection 'create_dbt_hol_2025_dev_public' was left open.
[0m00:39:07.568669 [debug] [MainThread]: On create_dbt_hol_2025_dev_public: Close
[0m00:39:07.742040 [info ] [MainThread]: 
[0m00:39:07.743277 [info ] [MainThread]: Finished running  in 0 hours 0 minutes and 1.27 seconds (1.27s).
[0m00:39:07.744263 [error] [MainThread]: Encountered an error:
Database Error
  003041 (42710): SQL compilation error:
  Schema 'PUBLIC' already exists, but current role has no privileges on it. If this is unexpected and you cannot resolve this problem, contact your system administrator. ACCOUNTADMIN role may be required to manage the privileges on the object.
[0m00:39:07.746261 [debug] [MainThread]: Command `dbt seed` failed at 00:39:07.746261 after 4.80 seconds
[0m00:39:07.747260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A8F6906EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A897F64700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002A899A9E920>]}
[0m00:39:07.747762 [debug] [MainThread]: Flushing usage events
[0m00:39:07.987902 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:40:23.006095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002499398AE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002499470B820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024994709420>]}


============================== 00:40:23.010095 | 048ceeaa-b13f-4377-8f7b-18d38d4f83d7 ==============================
[0m00:40:23.010095 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:40:23.011095 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt seed', 'send_anonymous_usage_stats': 'True'}
[0m00:40:24.013596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249943C3F70>]}
[0m00:40:24.092097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B52F4A30>]}
[0m00:40:24.093598 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m00:40:24.481598 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m00:40:24.766599 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:40:24.767099 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:40:24.829099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B58E4130>]}
[0m00:40:24.942600 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:40:24.945600 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:40:24.969601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B538C700>]}
[0m00:40:24.970100 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m00:40:24.971101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B58C3AF0>]}
[0m00:40:24.972600 [info ] [MainThread]: 
[0m00:40:24.973601 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:40:24.974101 [info ] [MainThread]: 
[0m00:40:24.974601 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:40:24.981100 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:40:25.110100 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:40:25.110600 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:40:25.111600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:40:25.656601 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.545 seconds
[0m00:40:25.660102 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m00:40:25.661102 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m00:40:25.670101 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m00:40:25.671101 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m00:40:25.672103 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m00:40:25.674601 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m00:40:25.675602 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m00:40:25.678101 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:40:25.681101 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m00:40:25.681602 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m00:40:25.682102 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:40:25.682602 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m00:40:25.683102 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m00:40:25.683607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:40:25.684602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:40:25.686104 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:40:26.217603 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.533 seconds
[0m00:40:26.218103 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:40:26.218604 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:40:26.223104 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb858-020d-0931-000d-306b000451e2
[0m00:40:26.223603 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m00:40:26.224104 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m00:40:26.224603 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:40:26.243603 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb858-020d-0832-000d-306b0004b06a
[0m00:40:26.244103 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m00:40:26.244604 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m00:40:26.245103 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:40:26.292103 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb858-020d-0cc1-000d-306b000491fe
[0m00:40:26.292603 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m00:40:26.293104 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m00:40:26.293603 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m00:40:27.319107 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.100 seconds
[0m00:40:27.323107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B538C490>]}
[0m00:40:27.328108 [debug] [Thread-1 (]: Began running node seed.dbt_project.trading_books
[0m00:40:27.328607 [debug] [Thread-2 (]: Began running node seed.dbt_project.weights_table
[0m00:40:27.329606 [info ] [Thread-1 (]: 1 of 2 START seed file public.trading_books .................................... [RUN]
[0m00:40:27.330106 [info ] [Thread-2 (]: 2 of 2 START seed file public.weights_table .................................... [RUN]
[0m00:40:27.330608 [debug] [Thread-1 (]: Acquiring new snowflake connection 'seed.dbt_project.trading_books'
[0m00:40:27.331607 [debug] [Thread-2 (]: Acquiring new snowflake connection 'seed.dbt_project.weights_table'
[0m00:40:27.332107 [debug] [Thread-1 (]: Began compiling node seed.dbt_project.trading_books
[0m00:40:27.332606 [debug] [Thread-2 (]: Began compiling node seed.dbt_project.weights_table
[0m00:40:27.333106 [debug] [Thread-1 (]: Began executing node seed.dbt_project.trading_books
[0m00:40:27.333607 [debug] [Thread-2 (]: Began executing node seed.dbt_project.weights_table
[0m00:40:27.368607 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m00:40:27.369608 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m00:40:27.370607 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.trading_books"} */
create table dbt_hol_2025_dev.public.trading_books (TRADE_ID integer,TRADE_DATE date,TRADER_NAME text,DESK text,TICKER text,QUANTITY integer,PRICE float8,TRADE_TYPE text,NOTES text)
[0m00:40:27.371107 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.weights_table"} */
create table dbt_hol_2025_dev.public.weights_table (REGION text,DESK text,TARGET_ALLOCATION float8)
[0m00:40:27.371607 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m00:40:27.372107 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m00:40:28.041609 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.669 seconds
[0m00:40:28.053611 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m00:40:28.055110 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.683 seconds
[0m00:40:28.055609 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.weights_table"} */
BEGIN
[0m00:40:28.057609 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m00:40:28.058609 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.trading_books"} */
BEGIN
[0m00:40:28.172109 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m00:40:28.173109 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m00:40:28.173610 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.weights_table"} */
insert into dbt_hol_2025_dev.public.weights_table (REGION, DESK, TARGET_ALLOCATION) values
            (%s,%s,%s),(%s,%s,%s)...
[0m00:40:28.178609 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m00:40:28.180117 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m00:40:28.180611 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.trading_books"} */
insert into dbt_hol_2025_dev.public.trading_books (TRADE_ID, TRADE_DATE, TRADER_NAME, DESK, TICKER, QUANTITY, PRICE, TRADE_TYPE, NOTES) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%...
[0m00:40:28.755111 [debug] [Thread-1 (]: SQL status: SUCCESS 30 in 0.573 seconds
[0m00:40:28.755611 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m00:40:28.756111 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.trading_books"} */
COMMIT
[0m00:40:28.923560 [debug] [Thread-2 (]: SQL status: SUCCESS 2 in 0.749 seconds
[0m00:40:28.924560 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m00:40:28.925061 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "seed.dbt_project.weights_table"} */
COMMIT
[0m00:40:29.085897 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m00:40:29.092386 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.dbt_project.trading_books"
[0m00:40:29.117383 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B6F2C3A0>]}
[0m00:40:29.118383 [info ] [Thread-1 (]: 1 of 2 OK loaded seed file public.trading_books ................................ [[32mINSERT 30[0m in 1.79s]
[0m00:40:29.119383 [debug] [Thread-1 (]: Finished running node seed.dbt_project.trading_books
[0m00:40:29.297376 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.372 seconds
[0m00:40:29.298379 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.dbt_project.weights_table"
[0m00:40:29.301876 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '048ceeaa-b13f-4377-8f7b-18d38d4f83d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249B6F2C340>]}
[0m00:40:29.302876 [info ] [Thread-2 (]: 2 of 2 OK loaded seed file public.weights_table ................................ [[32mINSERT 2[0m in 1.97s]
[0m00:40:29.304376 [debug] [Thread-2 (]: Finished running node seed.dbt_project.weights_table
[0m00:40:29.305877 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:40:29.306376 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m00:40:29.306876 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m00:40:29.466425 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m00:40:29.467425 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m00:40:29.572377 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m00:40:29.573377 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m00:40:29.705030 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m00:40:29.706030 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m00:40:29.837380 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m00:40:29.837879 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m00:40:29.946769 [debug] [MainThread]: Connection 'seed.dbt_project.trading_books' was left open.
[0m00:40:29.947269 [debug] [MainThread]: On seed.dbt_project.trading_books: Close
[0m00:40:30.126508 [debug] [MainThread]: Connection 'seed.dbt_project.weights_table' was left open.
[0m00:40:30.127505 [debug] [MainThread]: On seed.dbt_project.weights_table: Close
[0m00:40:30.264427 [info ] [MainThread]: 
[0m00:40:30.265419 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 5.29 seconds (5.29s).
[0m00:40:30.267004 [debug] [MainThread]: Command end result
[0m00:40:30.294495 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:40:30.297492 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:40:30.304492 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m00:40:30.304991 [info ] [MainThread]: 
[0m00:40:30.305492 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:40:30.305993 [info ] [MainThread]: 
[0m00:40:30.306993 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m00:40:30.308492 [debug] [MainThread]: Command `dbt seed` succeeded at 00:40:30.307991 after 7.41 seconds
[0m00:40:30.308992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002499398AE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024993D02DA0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000249925A4C40>]}
[0m00:40:30.309491 [debug] [MainThread]: Flushing usage events
[0m00:40:30.497778 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:49:50.168661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5E616EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5F39B8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5F399120>]}


============================== 00:49:50.172160 | 1335d76e-4b11-4b7a-8c94-555362a99838 ==============================
[0m00:49:50.172160 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:49:50.173163 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:49:51.107175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5F080700>]}
[0m00:49:51.176663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5F0BFE20>]}
[0m00:49:51.178163 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m00:49:51.553664 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m00:49:51.831165 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:49:51.831665 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:49:51.894165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E005C8130>]}
[0m00:49:52.006166 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:49:52.009666 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:49:52.033672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E000A3C40>]}
[0m00:49:52.034167 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m00:49:52.035168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E000A3E50>]}
[0m00:49:52.036667 [info ] [MainThread]: 
[0m00:49:52.037667 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:49:52.038167 [info ] [MainThread]: 
[0m00:49:52.038666 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:49:52.045665 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:49:52.046667 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:49:52.059165 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m00:49:52.178167 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:49:52.178667 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:49:52.179166 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m00:49:52.179666 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:49:52.180166 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:49:52.180666 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m00:49:52.181166 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:52.181666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:52.181666 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:52.821068 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.639 seconds
[0m00:49:52.839337 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.658 seconds
[0m00:49:52.852336 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.671 seconds
[0m00:49:52.854346 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_dev, now create_dbt_hol_2025_dev_public_01_staging)
[0m00:49:52.854837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_dev, now create_dbt_hol_2025_dev_public_03_marts)
[0m00:49:52.855346 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_dev, now create_dbt_hol_2025_dev_public_02_intermediate)
[0m00:49:52.855915 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_dev"
schema: "public_01_staging"
"
[0m00:49:52.856622 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_dev"
schema: "public_03_marts"
"
[0m00:49:52.857647 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_dev"
schema: "public_02_intermediate"
"
[0m00:49:52.862634 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_dev_public_01_staging"
[0m00:49:52.865135 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_dev_public_03_marts"
[0m00:49:52.867634 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_dev_public_02_intermediate"
[0m00:49:52.868134 [debug] [ThreadPool]: On create_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "create_dbt_hol_2025_dev_public_01_staging"} */
create schema if not exists dbt_hol_2025_dev.public_01_staging
[0m00:49:52.868636 [debug] [ThreadPool]: On create_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "create_dbt_hol_2025_dev_public_03_marts"} */
create schema if not exists dbt_hol_2025_dev.public_03_marts
[0m00:49:52.869636 [debug] [ThreadPool]: On create_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "create_dbt_hol_2025_dev_public_02_intermediate"} */
create schema if not exists dbt_hol_2025_dev.public_02_intermediate
[0m00:49:53.042870 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.172 seconds
[0m00:49:53.064108 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.193 seconds
[0m00:49:53.086098 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.216 seconds
[0m00:49:53.089603 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m00:49:53.090599 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m00:49:53.099098 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m00:49:53.101601 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m00:49:53.102599 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m00:49:53.105097 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m00:49:53.108099 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:49:53.108601 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m00:49:53.111097 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m00:49:53.111598 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m00:49:53.112097 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m00:49:53.112605 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:53.113102 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m00:49:53.113598 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:53.114097 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:53.115111 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:49:53.449823 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.337 seconds
[0m00:49:53.450824 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m00:49:53.451324 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:49:53.460817 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.347 seconds
[0m00:49:53.461316 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m00:49:53.461817 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:49:53.488534 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.373 seconds
[0m00:49:53.489035 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m00:49:53.489535 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:49:53.629114 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.515 seconds
[0m00:49:53.629614 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:49:53.630114 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:49:54.659079 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.207 seconds
[0m00:49:54.663567 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.174 seconds
[0m00:49:54.702105 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.071 seconds
[0m00:49:54.832003 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.369 seconds
[0m00:49:54.834503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5D1F3280>]}
[0m00:49:54.840001 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m00:49:54.840499 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m00:49:54.840999 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m00:49:54.841499 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m00:49:54.841999 [info ] [Thread-1 (]: 1 of 11 START sql view model public_01_staging.stg_forex_metrics ............... [RUN]
[0m00:49:54.842999 [info ] [Thread-2 (]: 2 of 11 START sql view model public_01_staging.stg_stock_metrics ............... [RUN]
[0m00:49:54.844001 [info ] [Thread-3 (]: 3 of 11 START sql view model public_01_staging.stg_trading_books ............... [RUN]
[0m00:49:54.844502 [info ] [Thread-4 (]: 4 of 11 START sql view model public_01_staging.stg_weights ..................... [RUN]
[0m00:49:54.845501 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m00:49:54.846500 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m00:49:54.847000 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m00:49:54.847502 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m00:49:54.848500 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m00:49:54.848999 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m00:49:54.850001 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m00:49:54.850500 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m00:49:54.858000 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m00:49:54.860500 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m00:49:54.864499 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m00:49:54.867499 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m00:49:54.870500 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m00:49:54.871001 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m00:49:54.886000 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m00:49:54.894999 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.stg_stock_metrics"
[0m00:49:54.895499 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m00:49:54.898499 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.stg_weights"
[0m00:49:54.900798 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.stg_forex_metrics"
[0m00:49:54.904798 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.stg_trading_books"
[0m00:49:54.906797 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m00:49:54.907797 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m00:49:54.908798 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m00:49:54.909299 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_weights"} */
create or replace   view dbt_hol_2025_dev.public_01_staging.stg_weights
  
   as (
    with source as (
    select *
    from dbt_hol_2025_dev.public.weights_table
),
renamed as (
    select region,
        desk,
        target_allocation
    from source
)
select *
from renamed
  );
[0m00:49:54.909798 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_stock_metrics"} */
create or replace   view dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
  
   as (
    with source as (
    select * from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.STOCK.US_STOCK_METRICS
),

renamed as (
    select
        run_date,
        ticker,
        open as open_price,
        high as high_price,
        low as low_price,
        close as close_price,
        volume
    from source
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
  );
[0m00:49:54.910799 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m00:49:54.911299 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_forex_metrics"} */
create or replace   view dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
  
   as (
    with source as (
    select * from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.STOCK.FOREX_METRICS
),
renamed as (
    select
        run_date,
        currency_pair_name,
        open as open_rate,
        high as high_rate,
        low as low_rate,
        close as close_rate
    from source   
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
  );
[0m00:49:54.911799 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:49:54.912298 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m00:49:54.912797 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_trading_books"} */
create or replace   view dbt_hol_2025_dev.public_01_staging.stg_trading_books
  
   as (
    with source as (
    select * from dbt_hol_2025_dev.public.trading_books
),

renamed as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes
    from source
)

select * from renamed
  );
[0m00:49:54.913298 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m00:49:54.915797 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m00:49:55.643933 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.731 seconds
[0m00:49:55.664932 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5BDD9C00>]}
[0m00:49:55.665939 [info ] [Thread-1 (]: 1 of 11 OK created sql view model public_01_staging.stg_forex_metrics .......... [[32mSUCCESS 1[0m in 0.82s]
[0m00:49:55.667156 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m00:49:55.866884 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.955 seconds
[0m00:49:55.869385 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E00C409D0>]}
[0m00:49:55.870884 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.959 seconds
[0m00:49:55.873885 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01CB9F00>]}
[0m00:49:55.871383 [info ] [Thread-2 (]: 2 of 11 OK created sql view model public_01_staging.stg_stock_metrics .......... [[32mSUCCESS 1[0m in 1.02s]
[0m00:49:55.874384 [info ] [Thread-4 (]: 4 of 11 OK created sql view model public_01_staging.stg_weights ................ [[32mSUCCESS 1[0m in 1.03s]
[0m00:49:55.875384 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m00:49:55.876385 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m00:49:56.072595 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.157 seconds
[0m00:49:56.075095 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E00C11840>]}
[0m00:49:56.076097 [info ] [Thread-3 (]: 3 of 11 OK created sql view model public_01_staging.stg_trading_books .......... [[32mSUCCESS 1[0m in 1.23s]
[0m00:49:56.077102 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m00:49:56.078490 [debug] [Thread-1 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m00:49:56.079016 [debug] [Thread-2 (]: Began running node model.dbt_project.int_extracted_entities
[0m00:49:56.079515 [debug] [Thread-4 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m00:49:56.080503 [info ] [Thread-1 (]: 5 of 11 START sql view model public_02_intermediate.int_equity_trade_pnl ....... [RUN]
[0m00:49:56.081003 [info ] [Thread-2 (]: 6 of 11 START sql view model public_02_intermediate.int_extracted_entities ..... [RUN]
[0m00:49:56.082002 [info ] [Thread-4 (]: 7 of 11 START sql view model public_02_intermediate.int_fx_trade_pnl ........... [RUN]
[0m00:49:56.083005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now model.dbt_project.int_equity_trade_pnl)
[0m00:49:56.083503 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now model.dbt_project.int_extracted_entities)
[0m00:49:56.084004 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now model.dbt_project.int_fx_trade_pnl)
[0m00:49:56.084502 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m00:49:56.085503 [debug] [Thread-2 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m00:49:56.086004 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m00:49:56.090502 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m00:49:56.093502 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m00:49:56.097002 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m00:49:56.103189 [debug] [Thread-2 (]: Began executing node model.dbt_project.int_extracted_entities
[0m00:49:56.103704 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m00:49:56.106702 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.int_extracted_entities"
[0m00:49:56.110201 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.int_equity_trade_pnl"
[0m00:49:56.110703 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m00:49:56.114703 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_fx_trade_pnl"
[0m00:49:56.119701 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m00:49:56.120701 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m00:49:56.121201 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
create or replace   view dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
  
   as (
    with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'Equity Desk'
),

stock_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        and b1.trade_date <= b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity as pnl_usd  -- Same as pnl since already in USD
    from matched_trades m
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        s.open_price as day_open,
        s.close_price as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((s.open_price - t.price) / s.open_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.open_price) / s.open_price) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((s.close_price - t.price) / s.close_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.close_price) / s.close_price) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((s.close_price - s.open_price) / s.open_price) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price then 'Better than open'
                    when t.price > s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price then 'Better than open'
                    when t.price < s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.close_price then 'Better than close'
                    when t.price > s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.close_price then 'Better than close'
                    when t.price < s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then 'Best price of day'
                    when t.price > s.open_price and t.price > s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then 'Best price of day'
                    when t.price < s.open_price and t.price < s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    else
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    else
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join stock_metrics s
    join stock_metrics s
        on t.ticker = s.ticker
        and t.trade_date = s.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
  );
[0m00:49:56.122203 [debug] [Thread-2 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
create or replace   view dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
  
   as (
    with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
),

-- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
cst as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes,
        SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
        SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
        SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
    from trading_books
    where notes is not null
)
select * from cst
  );
[0m00:49:56.125702 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m00:49:56.127703 [debug] [Thread-4 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
create or replace   view dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
  
   as (
    with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'FX Desk'
),

forex_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        -- and b1.trade_date <= b2.trade_date
        and b1.trade_date = b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        f.close_rate,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity * f.close_rate as pnl_usd
    from matched_trades m
    -- left join forex_metrics f
    join forex_metrics f
        on m.ticker = f.currency_pair_name
        and m.sell_date = f.run_date
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        f.open_rate as day_open,
        f.close_rate as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((f.open_rate - t.price) / f.open_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((f.close_rate - t.price) / f.close_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.close_rate) / f.close_rate) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((f.close_rate - f.open_rate) / f.open_rate) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate then 'Better than open'
                    when t.price > f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate then 'Better than open'
                    when t.price < f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.close_rate then 'Better than close'
                    when t.price > f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.close_rate then 'Better than close'
                    when t.price < f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then 'Best price of day'
                    when t.price > f.open_rate and t.price > f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then 'Best price of day'
                    when t.price < f.open_rate and t.price < f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    else
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    else
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join forex_metrics f
    join forex_metrics f
        on t.ticker = f.currency_pair_name
        and t.trade_date = f.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
  );
[0m00:49:56.707256 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.580 seconds
[0m00:49:56.709756 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E00BFC850>]}
[0m00:49:56.710756 [info ] [Thread-2 (]: 6 of 11 OK created sql view model public_02_intermediate.int_extracted_entities  [[32mSUCCESS 1[0m in 0.63s]
[0m00:49:56.711758 [debug] [Thread-2 (]: Finished running node model.dbt_project.int_extracted_entities
[0m00:49:56.712756 [debug] [Thread-3 (]: Began running node model.dbt_project.fct_trader_drivers
[0m00:49:56.713255 [info ] [Thread-3 (]: 8 of 11 START sql view model public_03_marts.fct_trader_drivers ................ [RUN]
[0m00:49:56.714255 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now model.dbt_project.fct_trader_drivers)
[0m00:49:56.714757 [debug] [Thread-3 (]: Began compiling node model.dbt_project.fct_trader_drivers
[0m00:49:56.718256 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.fct_trader_drivers"
[0m00:49:56.720756 [debug] [Thread-3 (]: Began executing node model.dbt_project.fct_trader_drivers
[0m00:49:56.733255 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.fct_trader_drivers"
[0m00:49:56.736181 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m00:49:56.736681 [debug] [Thread-3 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
create or replace   view dbt_hol_2025_dev.public_03_marts.fct_trader_drivers
  
   as (
    with extracted_entities as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
),

-- Calculate trade driver statistics by trader
trader_driver_stats as (
    select
        trader_name,
        trade_driver,
        count(*) as total_trades,
        array_agg(distinct signal[0]:"answer"::string) as signals_used
    from extracted_entities
    where trade_driver is not null
    group by 1, 2
),

-- Calculate total trades per trader for percentage calculation
trader_totals as (
    select
        trader_name,
        sum(total_trades) as total_trades
    from trader_driver_stats
    group by 1
),

-- Combine statistics with percentages
final_stats as (
    select
        tds.trader_name,
        tds.trade_driver,
        tds.total_trades,
        tds.signals_used,
        round(tds.total_trades * 100.0 / nullif(tt.total_trades, 0), 2) as driver_percentage
    from trader_driver_stats tds
    join trader_totals tt
        on tds.trader_name = tt.trader_name
)

select * from final_stats
order by trader_name, total_trades desc
  );
[0m00:49:57.351591 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.225 seconds
[0m00:49:57.354091 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01D61FF0>]}
[0m00:49:57.355091 [info ] [Thread-1 (]: 5 of 11 OK created sql view model public_02_intermediate.int_equity_trade_pnl .. [[32mSUCCESS 1[0m in 1.27s]
[0m00:49:57.356091 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m00:49:57.421743 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.293 seconds
[0m00:49:57.424243 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E00BFDC90>]}
[0m00:49:57.425244 [info ] [Thread-4 (]: 7 of 11 OK created sql view model public_02_intermediate.int_fx_trade_pnl ...... [[32mSUCCESS 1[0m in 1.34s]
[0m00:49:57.426244 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m00:49:57.427243 [debug] [Thread-2 (]: Began running node model.dbt_project.int_trade_pnl
[0m00:49:57.427744 [info ] [Thread-2 (]: 9 of 11 START sql view model public_02_intermediate.int_trade_pnl .............. [RUN]
[0m00:49:57.428744 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_trade_pnl)
[0m00:49:57.429743 [debug] [Thread-2 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m00:49:57.433245 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m00:49:57.435244 [debug] [Thread-2 (]: Began executing node model.dbt_project.int_trade_pnl
[0m00:49:57.439243 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.int_trade_pnl"
[0m00:49:57.441243 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m00:49:57.441743 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
create or replace   view dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
  
   as (
    with equity_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
),

fx_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
)

select * from equity_trades
union all
select * from fx_trades
  );
[0m00:49:57.859405 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.122 seconds
[0m00:49:57.861904 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01D8BD00>]}
[0m00:49:57.862907 [info ] [Thread-3 (]: 8 of 11 OK created sql view model public_03_marts.fct_trader_drivers ........... [[32mSUCCESS 1[0m in 1.15s]
[0m00:49:57.863913 [debug] [Thread-3 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m00:49:58.692652 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.250 seconds
[0m00:49:58.694652 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01D97AF0>]}
[0m00:49:58.695651 [info ] [Thread-2 (]: 9 of 11 OK created sql view model public_02_intermediate.int_trade_pnl ......... [[32mSUCCESS 1[0m in 1.27s]
[0m00:49:58.696654 [debug] [Thread-2 (]: Finished running node model.dbt_project.int_trade_pnl
[0m00:49:58.697651 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m00:49:58.698151 [info ] [Thread-4 (]: 10 of 11 START sql view model public_03_marts.fct_pnl_by_desk .................. [RUN]
[0m00:49:58.699151 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_fx_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m00:49:58.699651 [debug] [Thread-4 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m00:49:58.702651 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m00:49:58.704154 [debug] [Thread-4 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m00:49:58.706651 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_by_desk"
[0m00:49:58.709652 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m00:49:58.710161 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
create or replace   view dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
  
   as (
    with trade_performance as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
),

-- Calculate daily P&L metrics by desk and ticker
daily_desk_metrics as (
    select
        p.desk,
        p.ticker,
        p.sell_date as trade_date,
        case 
            when p.ticker like '%/%' then 'Europe'
            else 'North America'
        end as region,
        count(distinct p.buy_trade_id) as total_trades,
        sum(p.quantity) as total_quantity,
        sum(p.pnl_usd) as total_pnl_usd,
        avg(p.quantity) as avg_trade_size,
        avg(p.pnl_usd) as avg_pnl_usd,
        -- Add trading performance metrics
        avg(p.vs_open_performance_pct) as avg_vs_open_performance_pct,
        avg(p.vs_close_performance_pct) as avg_vs_close_performance_pct,
        avg(p.market_daily_performance_pct) as avg_market_performance_pct,
        avg(p.relative_performance_pct) as avg_relative_performance_pct,
        count(case when p.price_performance = 'Best price of day' then 1 end) as best_price_trades,
        count(case when p.price_performance = 'Worst price of day' then 1 end) as worst_price_trades,
        count(case when p.price_performance = 'Middle price of day' then 1 end) as middle_price_trades
    from trade_performance p
    where p.buy_trade_id is not null  -- Only include matched trades
    group by 1, 2, 3, 4
),

-- Calculate cumulative metrics
cumulative_metrics as (
    select
        desk,
        ticker,
        trade_date,
        region,
        total_trades,
        total_quantity,
        total_pnl_usd,
        avg_trade_size,
        avg_pnl_usd,
        avg_vs_open_performance_pct,
        avg_vs_close_performance_pct,
        avg_market_performance_pct,
        avg_relative_performance_pct,
        best_price_trades,
        worst_price_trades,
        middle_price_trades,
        sum(total_pnl_usd) over (partition by desk, ticker order by trade_date) as cumulative_pnl_usd
    from daily_desk_metrics
)

select * from cumulative_metrics
  );
[0m00:50:00.027506 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.316 seconds
[0m00:50:00.030007 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01D31000>]}
[0m00:50:00.031507 [info ] [Thread-4 (]: 10 of 11 OK created sql view model public_03_marts.fct_pnl_by_desk ............. [[32mSUCCESS 1[0m in 1.33s]
[0m00:50:00.033004 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m00:50:00.034003 [debug] [Thread-3 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m00:50:00.035002 [info ] [Thread-3 (]: 11 of 11 START sql view model public_03_marts.fct_pnl_vs_target ................ [RUN]
[0m00:50:00.036003 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.fct_trader_drivers, now model.dbt_project.fct_pnl_vs_target)
[0m00:50:00.036504 [debug] [Thread-3 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m00:50:00.040502 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m00:50:00.043504 [debug] [Thread-3 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m00:50:00.048004 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_vs_target"
[0m00:50:00.052502 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m00:50:00.053508 [debug] [Thread-3 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
create or replace   view dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target
  
   as (
    with pnl_by_desk as (
    select * from dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
),

weights as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_weights
),

-- Calculate total portfolio value by desk and region
portfolio_value as (
    select
        trade_date,
        desk,
        region,
        sum(total_pnl_usd) as portfolio_value_usd,
        avg(avg_vs_open_performance_pct) as portfolio_vs_open_performance,
        avg(avg_vs_close_performance_pct) as portfolio_vs_close_performance,
        avg(avg_market_performance_pct) as portfolio_market_performance,
        avg(avg_relative_performance_pct) as portfolio_relative_performance,
        sum(best_price_trades) as total_best_price_trades,
        sum(worst_price_trades) as total_worst_price_trades,
        sum(middle_price_trades) as total_middle_price_trades
    from pnl_by_desk
    group by 1, 2, 3
),

-- Calculate total portfolio value across all desks and regions for each date
total_portfolio_value as (
    select
        trade_date,
        sum(portfolio_value_usd) as total_portfolio_value_usd
    from portfolio_value
    group by 1
),

-- Calculate actual allocations and compare with targets
allocation_variance as (
    select
        pv.trade_date,
        pv.desk,
        pv.region,
        w.target_allocation,
        pv.portfolio_value_usd,
        tp.total_portfolio_value_usd,
        pv.portfolio_vs_open_performance,
        pv.portfolio_vs_close_performance,
        pv.portfolio_market_performance,
        pv.portfolio_relative_performance,
        pv.total_best_price_trades,
        pv.total_worst_price_trades,
        pv.total_middle_price_trades,
        pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) as actual_allocation,
        (pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) - w.target_allocation) as allocation_variance,
        case
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) > w.target_allocation then 'Overweight'
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) < w.target_allocation then 'Underweight'
            else 'On Target'
        end as allocation_status
    from portfolio_value pv
    join total_portfolio_value tp
        on pv.trade_date = tp.trade_date
    join weights w
        on pv.desk = w.desk
        and pv.region = w.region
)

select * from allocation_variance
  );
[0m00:50:01.667634 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.613 seconds
[0m00:50:01.670131 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1335d76e-4b11-4b7a-8c94-555362a99838', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E01D31000>]}
[0m00:50:01.671132 [info ] [Thread-3 (]: 11 of 11 OK created sql view model public_03_marts.fct_pnl_vs_target ........... [[32mSUCCESS 1[0m in 1.63s]
[0m00:50:01.672133 [debug] [Thread-3 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m00:50:01.673632 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:50:01.674131 [debug] [MainThread]: Connection 'create_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m00:50:01.674633 [debug] [MainThread]: On create_dbt_hol_2025_dev_public_02_intermediate: Close
[0m00:50:02.526415 [debug] [MainThread]: Connection 'create_dbt_hol_2025_dev_public_03_marts' was left open.
[0m00:50:02.527415 [debug] [MainThread]: On create_dbt_hol_2025_dev_public_03_marts: Close
[0m00:50:02.651561 [debug] [MainThread]: Connection 'create_dbt_hol_2025_dev_public_01_staging' was left open.
[0m00:50:02.652060 [debug] [MainThread]: On create_dbt_hol_2025_dev_public_01_staging: Close
[0m00:50:02.765696 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m00:50:02.766198 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m00:50:02.979851 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m00:50:02.980350 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m00:50:03.087378 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m00:50:03.088358 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m00:50:03.218489 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m00:50:03.218988 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m00:50:03.342433 [debug] [MainThread]: Connection 'model.dbt_project.int_equity_trade_pnl' was left open.
[0m00:50:03.343433 [debug] [MainThread]: On model.dbt_project.int_equity_trade_pnl: Close
[0m00:50:03.473037 [debug] [MainThread]: Connection 'model.dbt_project.int_trade_pnl' was left open.
[0m00:50:03.473539 [debug] [MainThread]: On model.dbt_project.int_trade_pnl: Close
[0m00:50:03.591772 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was left open.
[0m00:50:03.592272 [debug] [MainThread]: On model.dbt_project.fct_pnl_vs_target: Close
[0m00:50:03.712936 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was left open.
[0m00:50:03.713436 [debug] [MainThread]: On model.dbt_project.fct_pnl_by_desk: Close
[0m00:50:03.815492 [info ] [MainThread]: 
[0m00:50:03.816493 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 11.78 seconds (11.78s).
[0m00:50:03.819492 [debug] [MainThread]: Command end result
[0m00:50:03.846992 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:50:03.849491 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:50:03.857991 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m00:50:03.858492 [info ] [MainThread]: 
[0m00:50:03.859493 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:50:03.859992 [info ] [MainThread]: 
[0m00:50:03.860494 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m00:50:03.861992 [debug] [MainThread]: Command `dbt run` succeeded at 00:50:03.861992 after 13.81 seconds
[0m00:50:03.862492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5E616EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E5F0BFE20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000028E005C88E0>]}
[0m00:50:03.862992 [debug] [MainThread]: Flushing usage events
[0m00:50:04.211992 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:51:07.894219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AABA6E60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AB929420>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AB92B2E0>]}


============================== 00:51:07.897719 | a16e95f8-5e2c-45d5-81fe-5247429ddce9 ==============================
[0m00:51:07.897719 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:51:07.898219 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m00:51:08.852721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AAEFFBE0>]}
[0m00:51:08.923221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AB92A740>]}
[0m00:51:08.924721 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m00:51:09.306726 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m00:51:09.590224 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:51:09.590723 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:51:09.653224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3CCB04130>]}
[0m00:51:09.686224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3CC5A8B20>]}
[0m00:51:09.686724 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m00:51:09.687224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3CC5A9A20>]}
[0m00:51:09.689724 [info ] [MainThread]: 
[0m00:51:09.690224 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:51:09.690725 [info ] [MainThread]: 
[0m00:51:09.691725 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m00:51:09.698224 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m00:51:09.699226 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m00:51:09.706725 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m00:51:09.718725 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m00:51:09.841540 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m00:51:09.842040 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m00:51:09.843040 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:51:09.843542 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m00:51:09.844040 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m00:51:09.845040 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m00:51:09.845541 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m00:51:09.846043 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m00:51:09.846540 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:09.847040 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:09.847540 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:09.848042 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:10.425350 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.577 seconds
[0m00:51:10.426350 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m00:51:10.426850 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:51:10.432425 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.585 seconds
[0m00:51:10.433427 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m00:51:10.433926 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:51:10.440926 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.594 seconds
[0m00:51:10.441425 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m00:51:10.442427 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:51:10.481896 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.634 seconds
[0m00:51:10.482897 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m00:51:10.482897 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m00:51:11.766135 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.323 seconds
[0m00:51:11.887531 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.404 seconds
[0m00:51:11.895532 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.468 seconds
[0m00:51:12.394063 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.959 seconds
[0m00:51:12.398064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a16e95f8-5e2c-45d5-81fe-5247429ddce9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3CC5A9D80>]}
[0m00:51:12.403331 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m00:51:12.403828 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m00:51:12.404328 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m00:51:12.405328 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m00:51:12.405830 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m00:51:12.406831 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m00:51:12.407328 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m00:51:12.408331 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m00:51:12.408832 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m00:51:12.409833 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m00:51:12.410332 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m00:51:12.410829 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m00:51:12.417828 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m00:51:12.420328 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m00:51:12.422827 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m00:51:12.425827 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m00:51:12.427330 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m00:51:12.427831 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m00:51:12.428329 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m00:51:12.428830 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m00:51:12.429329 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m00:51:12.429829 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m00:51:12.430829 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m00:51:12.431330 [debug] [Thread-1 (]: Began running node seed.dbt_project.trading_books
[0m00:51:12.432328 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m00:51:12.432830 [debug] [Thread-2 (]: Began running node seed.dbt_project.weights_table
[0m00:51:12.433329 [debug] [Thread-3 (]: Began running node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3
[0m00:51:12.433831 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now seed.dbt_project.trading_books)
[0m00:51:12.434828 [debug] [Thread-4 (]: Began running node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5
[0m00:51:12.435329 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now seed.dbt_project.weights_table)
[0m00:51:12.435829 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3)
[0m00:51:12.436329 [debug] [Thread-1 (]: Began compiling node seed.dbt_project.trading_books
[0m00:51:12.436829 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5)
[0m00:51:12.437329 [debug] [Thread-2 (]: Began compiling node seed.dbt_project.weights_table
[0m00:51:12.437829 [debug] [Thread-3 (]: Began compiling node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3
[0m00:51:12.440829 [debug] [Thread-1 (]: Began executing node seed.dbt_project.trading_books
[0m00:51:12.441829 [debug] [Thread-4 (]: Began compiling node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5
[0m00:51:12.443828 [debug] [Thread-2 (]: Began executing node seed.dbt_project.weights_table
[0m00:51:12.453328 [debug] [Thread-3 (]: Writing injected SQL for node "test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3"
[0m00:51:12.454328 [debug] [Thread-1 (]: Finished running node seed.dbt_project.trading_books
[0m00:51:12.457829 [debug] [Thread-4 (]: Writing injected SQL for node "test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5"
[0m00:51:12.458829 [debug] [Thread-2 (]: Finished running node seed.dbt_project.weights_table
[0m00:51:12.459329 [debug] [Thread-1 (]: Began running node test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558
[0m00:51:12.460329 [debug] [Thread-2 (]: Began running node test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e
[0m00:51:12.461331 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly seed.dbt_project.trading_books, now test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558)
[0m00:51:12.461831 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly seed.dbt_project.weights_table, now test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e)
[0m00:51:12.462331 [debug] [Thread-3 (]: Began executing node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3
[0m00:51:12.462331 [debug] [Thread-4 (]: Began executing node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5
[0m00:51:12.462829 [debug] [Thread-1 (]: Began compiling node test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558
[0m00:51:12.463328 [debug] [Thread-2 (]: Began compiling node test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e
[0m00:51:12.464329 [debug] [Thread-3 (]: Finished running node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3
[0m00:51:12.465330 [debug] [Thread-4 (]: Finished running node test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5
[0m00:51:12.469330 [debug] [Thread-1 (]: Writing injected SQL for node "test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558"
[0m00:51:12.473330 [debug] [Thread-2 (]: Writing injected SQL for node "test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e"
[0m00:51:12.473830 [debug] [Thread-3 (]: Began running node test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461
[0m00:51:12.474329 [debug] [Thread-4 (]: Began running node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c
[0m00:51:12.475330 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_forex_data_FOREX_METRICS_CURRENCY_PAIR_NAME.cf5d8717d3, now test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461)
[0m00:51:12.476331 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_forex_data_FOREX_METRICS_RUN_DATE.26204858c5, now test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c)
[0m00:51:12.476331 [debug] [Thread-2 (]: Began executing node test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e
[0m00:51:12.476831 [debug] [Thread-1 (]: Began executing node test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558
[0m00:51:12.477332 [debug] [Thread-3 (]: Began compiling node test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461
[0m00:51:12.477828 [debug] [Thread-4 (]: Began compiling node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c
[0m00:51:12.478829 [debug] [Thread-2 (]: Finished running node test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e
[0m00:51:12.479330 [debug] [Thread-1 (]: Finished running node test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558
[0m00:51:12.484328 [debug] [Thread-3 (]: Writing injected SQL for node "test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461"
[0m00:51:12.487828 [debug] [Thread-4 (]: Writing injected SQL for node "test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c"
[0m00:51:12.488328 [debug] [Thread-2 (]: Began running node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442
[0m00:51:12.489331 [debug] [Thread-1 (]: Began running node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303
[0m00:51:12.490330 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_portfolio_data_weights_table_REGION.e83dfea39e, now test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442)
[0m00:51:12.490829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_portfolio_data_weights_table_DESK.793b27d558, now test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303)
[0m00:51:12.491332 [debug] [Thread-2 (]: Began compiling node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442
[0m00:51:12.491829 [debug] [Thread-3 (]: Began executing node test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461
[0m00:51:12.492328 [debug] [Thread-4 (]: Began executing node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c
[0m00:51:12.492828 [debug] [Thread-1 (]: Began compiling node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303
[0m00:51:12.496328 [debug] [Thread-2 (]: Writing injected SQL for node "test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442"
[0m00:51:12.497331 [debug] [Thread-3 (]: Finished running node test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461
[0m00:51:12.498328 [debug] [Thread-4 (]: Finished running node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c
[0m00:51:12.501828 [debug] [Thread-1 (]: Writing injected SQL for node "test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303"
[0m00:51:12.502830 [debug] [Thread-3 (]: Began running node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074
[0m00:51:12.503829 [debug] [Thread-4 (]: Began running node test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965
[0m00:51:12.504332 [debug] [Thread-2 (]: Began executing node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442
[0m00:51:12.504831 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_portfolio_data_weights_table_TARGET_ALLOCATION.e971048461, now test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074)
[0m00:51:12.505330 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_RUN_DATE.ad779e330c, now test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965)
[0m00:51:12.506330 [debug] [Thread-2 (]: Finished running node test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442
[0m00:51:12.506830 [debug] [Thread-1 (]: Began executing node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303
[0m00:51:12.507330 [debug] [Thread-3 (]: Began compiling node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074
[0m00:51:12.507830 [debug] [Thread-4 (]: Began compiling node test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965
[0m00:51:12.508328 [debug] [Thread-2 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m00:51:12.508833 [debug] [Thread-1 (]: Finished running node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303
[0m00:51:12.512828 [debug] [Thread-3 (]: Writing injected SQL for node "test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074"
[0m00:51:12.518328 [debug] [Thread-4 (]: Writing injected SQL for node "test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965"
[0m00:51:12.518831 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_stock_data_US_STOCK_METRICS_TICKER.c0c589a442, now model.dbt_project.int_equity_trade_pnl)
[0m00:51:12.519330 [debug] [Thread-1 (]: Began running node model.dbt_project.int_extracted_entities
[0m00:51:12.520829 [debug] [Thread-2 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m00:51:12.521329 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_trading_data_trading_books_TRADE_DATE.77788fe303, now model.dbt_project.int_extracted_entities)
[0m00:51:12.521831 [debug] [Thread-3 (]: Began executing node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074
[0m00:51:12.521831 [debug] [Thread-4 (]: Began executing node test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965
[0m00:51:12.525328 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m00:51:12.525831 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m00:51:12.526830 [debug] [Thread-3 (]: Finished running node test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074
[0m00:51:12.527830 [debug] [Thread-4 (]: Finished running node test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965
[0m00:51:12.531328 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m00:51:12.532330 [debug] [Thread-3 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m00:51:12.532828 [debug] [Thread-2 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m00:51:12.533832 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_not_null_trading_data_trading_books_TRADE_ID.5a97a78074, now model.dbt_project.int_fx_trade_pnl)
[0m00:51:12.534829 [debug] [Thread-2 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m00:51:12.535331 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m00:51:12.535331 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_extracted_entities
[0m00:51:12.538828 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m00:51:12.539830 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_extracted_entities
[0m00:51:12.540830 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_trader_drivers
[0m00:51:12.541329 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.dbt_project.source_unique_trading_data_trading_books_TRADE_ID.7618e2f965, now model.dbt_project.fct_trader_drivers)
[0m00:51:12.541831 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m00:51:12.542330 [debug] [Thread-4 (]: Began compiling node model.dbt_project.fct_trader_drivers
[0m00:51:12.542830 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m00:51:12.545328 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.fct_trader_drivers"
[0m00:51:12.546333 [debug] [Thread-1 (]: Began running node model.dbt_project.int_trade_pnl
[0m00:51:12.546828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_trade_pnl)
[0m00:51:12.547330 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m00:51:12.547830 [debug] [Thread-4 (]: Began executing node model.dbt_project.fct_trader_drivers
[0m00:51:12.550328 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m00:51:12.551330 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m00:51:12.552334 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_trade_pnl
[0m00:51:12.553330 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_trade_pnl
[0m00:51:12.553829 [debug] [Thread-3 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m00:51:12.554329 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_fx_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m00:51:12.555330 [debug] [Thread-3 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m00:51:12.557828 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m00:51:12.559331 [debug] [Thread-3 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m00:51:12.559830 [debug] [Thread-3 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m00:51:12.560829 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m00:51:12.561330 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.fct_trader_drivers, now model.dbt_project.fct_pnl_vs_target)
[0m00:51:12.561829 [debug] [Thread-4 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m00:51:12.564328 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m00:51:12.565832 [debug] [Thread-4 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m00:51:12.566830 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m00:51:12.567829 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:51:12.567829 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m00:51:12.568330 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m00:51:13.295804 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m00:51:13.296303 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m00:51:13.417393 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m00:51:13.417893 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m00:51:13.521802 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m00:51:13.522802 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m00:51:13.638813 [debug] [MainThread]: Connection 'model.dbt_project.int_trade_pnl' was properly closed.
[0m00:51:13.639816 [debug] [MainThread]: Connection 'model.dbt_project.int_equity_trade_pnl' was properly closed.
[0m00:51:13.640316 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was properly closed.
[0m00:51:13.640813 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was properly closed.
[0m00:51:13.644801 [debug] [MainThread]: Command end result
[0m00:51:13.757300 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:51:13.760301 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:51:13.768800 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m00:51:13.780579 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m00:51:13.781078 [info ] [MainThread]: Building catalog
[0m00:51:13.793077 [debug] [ThreadPool]: Acquiring new snowflake connection 'dbt_hol_2025_dev.information_schema'
[0m00:51:13.793583 [debug] [ThreadPool]: Acquiring new snowflake connection 'FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema'
[0m00:51:13.809580 [debug] [ThreadPool]: Using snowflake connection "dbt_hol_2025_dev.information_schema"
[0m00:51:13.810077 [debug] [ThreadPool]: Acquiring new snowflake connection 'STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema'
[0m00:51:13.814577 [debug] [ThreadPool]: Using snowflake connection "FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema"
[0m00:51:13.815578 [debug] [ThreadPool]: On dbt_hol_2025_dev.information_schema: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "dbt_hol_2025_dev.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from dbt_hol_2025_dev.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_pnl_vs_target' and upper("table_name") = upper('fct_pnl_vs_target')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_trading_books' and upper("table_name") = upper('stg_trading_books')

                )
             or 
                (
                    
    "table_schema" ilike 'public' and upper("table_schema") = upper('public')

                    and 
    "table_name" ilike 'weights_table' and upper("table_name") = upper('weights_table')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_equity_trade_pnl' and upper("table_name") = upper('int_equity_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public' and upper("table_schema") = upper('public')

                    and 
    "table_name" ilike 'trading_books' and upper("table_name") = upper('trading_books')

                )
             or 
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_pnl_by_desk' and upper("table_name") = upper('fct_pnl_by_desk')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_extracted_entities' and upper("table_name") = upper('int_extracted_entities')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_fx_trade_pnl' and upper("table_name") = upper('int_fx_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_trade_pnl' and upper("table_name") = upper('int_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_forex_metrics' and upper("table_name") = upper('stg_forex_metrics')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_weights' and upper("table_name") = upper('stg_weights')

                )
             or 
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_trader_drivers' and upper("table_name") = upper('fct_trader_drivers')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_stock_metrics' and upper("table_name") = upper('stg_stock_metrics')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from dbt_hol_2025_dev.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_pnl_vs_target' and upper("table_name") = upper('fct_pnl_vs_target')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_trading_books' and upper("table_name") = upper('stg_trading_books')

                )
             or 
                (
                    
    "table_schema" ilike 'public' and upper("table_schema") = upper('public')

                    and 
    "table_name" ilike 'weights_table' and upper("table_name") = upper('weights_table')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_equity_trade_pnl' and upper("table_name") = upper('int_equity_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public' and upper("table_schema") = upper('public')

                    and 
    "table_name" ilike 'trading_books' and upper("table_name") = upper('trading_books')

                )
             or 
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_pnl_by_desk' and upper("table_name") = upper('fct_pnl_by_desk')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_extracted_entities' and upper("table_name") = upper('int_extracted_entities')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_fx_trade_pnl' and upper("table_name") = upper('int_fx_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public_02_intermediate' and upper("table_schema") = upper('public_02_intermediate')

                    and 
    "table_name" ilike 'int_trade_pnl' and upper("table_name") = upper('int_trade_pnl')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_forex_metrics' and upper("table_name") = upper('stg_forex_metrics')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_weights' and upper("table_name") = upper('stg_weights')

                )
             or 
                (
                    
    "table_schema" ilike 'public_03_marts' and upper("table_schema") = upper('public_03_marts')

                    and 
    "table_name" ilike 'fct_trader_drivers' and upper("table_name") = upper('fct_trader_drivers')

                )
             or 
                (
                    
    "table_schema" ilike 'public_01_staging' and upper("table_schema") = upper('public_01_staging')

                    and 
    "table_name" ilike 'stg_stock_metrics' and upper("table_name") = upper('stg_stock_metrics')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m00:51:13.820077 [debug] [ThreadPool]: Using snowflake connection "STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema"
[0m00:51:13.820578 [debug] [ThreadPool]: On FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'STOCK' and upper("table_schema") = upper('STOCK')

                    and 
    "table_name" ilike 'FOREX_METRICS' and upper("table_name") = upper('FOREX_METRICS')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'STOCK' and upper("table_schema") = upper('STOCK')

                    and 
    "table_name" ilike 'FOREX_METRICS' and upper("table_name") = upper('FOREX_METRICS')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m00:51:13.821580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:13.822077 [debug] [ThreadPool]: On STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'STOCK' and upper("table_schema") = upper('STOCK')

                    and 
    "table_name" ilike 'US_STOCK_METRICS' and upper("table_name") = upper('US_STOCK_METRICS')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'STOCK' and upper("table_schema") = upper('STOCK')

                    and 
    "table_name" ilike 'US_STOCK_METRICS' and upper("table_name") = upper('US_STOCK_METRICS')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m00:51:13.822577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:13.823578 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:51:16.520258 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 2.697 seconds
[0m00:51:16.540324 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 2.717 seconds
[0m00:51:19.752547 [debug] [ThreadPool]: SQL status: SUCCESS 168 in 5.931 seconds
[0m00:51:20.125324 [debug] [MainThread]: Wrote artifact CatalogArtifact to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\catalog.json
[0m00:51:20.150267 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m00:51:20.153267 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m00:51:20.153769 [info ] [MainThread]: Catalog written to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\catalog.json
[0m00:51:20.156273 [debug] [MainThread]: Command `dbt docs generate` succeeded at 00:51:20.156273 after 12.37 seconds
[0m00:51:20.156774 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m00:51:20.157274 [debug] [MainThread]: Connection 'dbt_hol_2025_dev.information_schema' was left open.
[0m00:51:20.157775 [debug] [MainThread]: On dbt_hol_2025_dev.information_schema: Close
[0m00:51:20.258553 [debug] [MainThread]: Connection 'FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema' was left open.
[0m00:51:20.259054 [debug] [MainThread]: On FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.information_schema: Close
[0m00:51:20.381290 [debug] [MainThread]: Connection 'STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema' was left open.
[0m00:51:20.382292 [debug] [MainThread]: On STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.information_schema: Close
[0m00:51:20.502855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AABA6E60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3CE177760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000001E3AB8FB220>]}
[0m00:51:20.503855 [debug] [MainThread]: Flushing usage events
[0m00:51:20.758888 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:51:22.986391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002462DAB6EC0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002462E83B8B0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002462E83A8F0>]}


============================== 00:51:22.990394 | f621f4cb-568b-40df-9cba-36c173d80510 ==============================
[0m00:51:22.990394 [info ] [MainThread]: Running with dbt=1.9.4
[0m00:51:22.991389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'invocation_command': 'dbt docs serve', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:51:23.942897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f621f4cb-568b-40df-9cba-36c173d80510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002462E83B130>]}
[0m00:51:24.014895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f621f4cb-568b-40df-9cba-36c173d80510', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002462E4C0AC0>]}
[0m01:03:55.947622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E676CAE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E685E62F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E685E5540>]}


============================== 01:03:55.951122 | fb17cc8f-81b8-4bdf-b4a8-00565b7af851 ==============================
[0m01:03:55.951122 [info ] [MainThread]: Running with dbt=1.9.4
[0m01:03:55.952122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:03:56.886126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E091010F0>]}
[0m01:03:56.957625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E68107850>]}
[0m01:03:56.959126 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m01:03:57.346128 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m01:03:57.538127 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:03:57.539630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E09275540>]}
[0m01:03:59.017632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0AB7DB70>]}
[0m01:03:59.212133 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:03:59.215136 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:03:59.239135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0A8D0CA0>]}
[0m01:03:59.239633 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m01:03:59.240637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E09872380>]}
[0m01:03:59.242132 [info ] [MainThread]: 
[0m01:03:59.243135 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:03:59.243634 [info ] [MainThread]: 
[0m01:03:59.244634 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:03:59.251133 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:03:59.251632 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:03:59.259634 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:03:59.392632 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:03:59.393132 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:03:59.393633 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:03:59.394133 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:03:59.394633 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:03:59.395137 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:03:59.395634 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:59.396135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:59.396634 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:59.992437 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.596 seconds
[0m01:03:59.992937 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.597 seconds
[0m01:03:59.993304 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.597 seconds
[0m01:03:59.999834 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m01:04:00.000817 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m01:04:00.011316 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:04:00.011816 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m01:04:00.012317 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m01:04:00.014817 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:04:00.015818 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m01:04:00.018817 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:04:00.022316 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:04:00.022817 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m01:04:00.023317 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:04:00.023817 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m01:04:00.024816 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m01:04:00.025316 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:04:00.025816 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:04:00.027317 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:04:00.502194 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.477 seconds
[0m01:04:00.502694 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:04:00.503194 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:04:00.505194 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.479 seconds
[0m01:04:00.505694 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:04:00.507194 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:04:00.521719 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.498 seconds
[0m01:04:00.522721 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:04:00.523219 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:04:00.525219 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.498 seconds
[0m01:04:00.525718 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:04:00.527219 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:04:02.080674 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.577 seconds
[0m01:04:02.177175 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.669 seconds
[0m01:04:02.184676 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.657 seconds
[0m01:04:02.187676 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.664 seconds
[0m01:04:02.191676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0971C250>]}
[0m01:04:02.196175 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m01:04:02.196676 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m01:04:02.197180 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m01:04:02.197676 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m01:04:02.198175 [info ] [Thread-1 (]: 1 of 11 START sql table model public_01_staging.stg_forex_metrics .............. [RUN]
[0m01:04:02.198675 [info ] [Thread-2 (]: 2 of 11 START sql table model public_01_staging.stg_stock_metrics .............. [RUN]
[0m01:04:02.199676 [info ] [Thread-3 (]: 3 of 11 START sql table model public_01_staging.stg_trading_books .............. [RUN]
[0m01:04:02.200176 [info ] [Thread-4 (]: 4 of 11 START sql table model public_01_staging.stg_weights .................... [RUN]
[0m01:04:02.201175 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m01:04:02.201677 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m01:04:02.202676 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m01:04:02.203176 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m01:04:02.204176 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m01:04:02.204677 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m01:04:02.205175 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m01:04:02.205676 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m01:04:02.213676 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m01:04:02.216675 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m01:04:02.220176 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m01:04:02.223676 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m01:04:02.225677 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m01:04:02.226177 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m01:04:02.226676 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m01:04:02.237675 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m01:04:02.244175 [debug] [Thread-1 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_FOREX_METRICS" because it is a view and target relation dbt_hol_2025_dev.public_01_staging.stg_forex_metrics is of type table.
[0m01:04:02.247177 [debug] [Thread-2 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_STOCK_METRICS" because it is a view and target relation dbt_hol_2025_dev.public_01_staging.stg_stock_metrics is of type table.
[0m01:04:02.249174 [debug] [Thread-3 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_TRADING_BOOKS" because it is a view and target relation dbt_hol_2025_dev.public_01_staging.stg_trading_books is of type table.
[0m01:04:02.251675 [debug] [Thread-4 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_WEIGHTS" because it is a view and target relation dbt_hol_2025_dev.public_01_staging.stg_weights is of type table.
[0m01:04:02.259176 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_FOREX_METRICS"
[0m01:04:02.262177 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_STOCK_METRICS"
[0m01:04:02.265177 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_TRADING_BOOKS"
[0m01:04:02.268175 [debug] [Thread-4 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_WEIGHTS"
[0m01:04:02.274175 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m01:04:02.275179 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m01:04:02.276175 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m01:04:02.276678 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m01:04:02.277675 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_forex_metrics"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_FOREX_METRICS" cascade
[0m01:04:02.278178 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_stock_metrics"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_STOCK_METRICS" cascade
[0m01:04:02.278675 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_trading_books"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_TRADING_BOOKS" cascade
[0m01:04:02.279175 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_weights"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_01_STAGING"."STG_WEIGHTS" cascade
[0m01:04:02.279675 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:04:02.280175 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:04:02.280680 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:04:02.281176 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:04:02.778391 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.498 seconds
[0m01:04:02.792391 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.stg_stock_metrics"
[0m01:04:02.794391 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m01:04:02.795391 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_stock_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
         as
        (with source as (
    select * from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.STOCK.US_STOCK_METRICS
),

renamed as (
    select
        run_date,
        ticker,
        open as open_price,
        high as high_price,
        low as low_price,
        close as close_price,
        volume
    from source
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:04:02.809392 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.528 seconds
[0m01:04:02.810891 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.stg_trading_books"
[0m01:04:02.817893 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m01:04:02.818392 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_trading_books"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_trading_books
         as
        (with source as (
    select * from dbt_hol_2025_dev.public.trading_books
),

renamed as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes
    from source
)

select * from renamed
        );
[0m01:04:02.866893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.587 seconds
[0m01:04:02.868892 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.stg_forex_metrics"
[0m01:04:02.870893 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m01:04:02.871392 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_forex_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
         as
        (with source as (
    select * from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.STOCK.FOREX_METRICS
),
renamed as (
    select
        run_date,
        currency_pair_name,
        open as open_rate,
        high as high_rate,
        low as low_rate,
        close as close_rate
    from source   
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:04:02.887893 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.606 seconds
[0m01:04:02.889393 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.stg_weights"
[0m01:04:02.890893 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m01:04:02.891392 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_weights"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_weights
         as
        (with source as (
    select *
    from dbt_hol_2025_dev.public.weights_table
),
renamed as (
    select region,
        desk,
        target_allocation
    from source
)
select *
from renamed
        );
[0m01:04:03.748217 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.856 seconds
[0m01:04:03.771216 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E091D4220>]}
[0m01:04:03.772217 [info ] [Thread-4 (]: 4 of 11 OK created sql table model public_01_staging.stg_weights ............... [[32mSUCCESS 1[0m in 1.57s]
[0m01:04:03.773219 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m01:04:04.659969 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.841 seconds
[0m01:04:04.662382 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E091D43D0>]}
[0m01:04:04.662880 [info ] [Thread-3 (]: 3 of 11 OK created sql table model public_01_staging.stg_trading_books ......... [[32mSUCCESS 1[0m in 2.46s]
[0m01:04:04.663881 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m01:04:04.664881 [debug] [Thread-4 (]: Began running node model.dbt_project.int_extracted_entities
[0m01:04:04.665881 [info ] [Thread-4 (]: 5 of 11 START sql table model public_02_intermediate.int_extracted_entities .... [RUN]
[0m01:04:04.666881 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now model.dbt_project.int_extracted_entities)
[0m01:04:04.667385 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m01:04:04.670881 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m01:04:04.672880 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_extracted_entities
[0m01:04:04.675381 [debug] [Thread-4 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES" because it is a view and target relation dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities is of type table.
[0m01:04:04.678382 [debug] [Thread-4 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES"
[0m01:04:04.679381 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:04:04.679880 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES" cascade
[0m01:04:04.871608 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.191 seconds
[0m01:04:04.873607 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_extracted_entities"
[0m01:04:04.876107 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:04:04.876607 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
create or replace transient table dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
         as
        (with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
),

-- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
cst as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes,
        SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
        SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
        SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
    from trading_books
    where notes is not null
)
select * from cst
        );
[0m01:04:05.175929 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.303 seconds
[0m01:04:05.178429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0AF09CF0>]}
[0m01:04:05.179429 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_01_staging.stg_forex_metrics ......... [[32mSUCCESS 1[0m in 2.98s]
[0m01:04:05.180822 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m01:04:05.181807 [debug] [Thread-3 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m01:04:05.182307 [info ] [Thread-3 (]: 6 of 11 START sql table model public_02_intermediate.int_fx_trade_pnl .......... [RUN]
[0m01:04:05.183308 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now model.dbt_project.int_fx_trade_pnl)
[0m01:04:05.183807 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m01:04:05.187807 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m01:04:05.189807 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m01:04:05.191807 [debug] [Thread-3 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL" because it is a view and target relation dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl is of type table.
[0m01:04:05.194307 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:04:05.194807 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:04:05.195307 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL" cascade
[0m01:04:05.435995 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.240 seconds
[0m01:04:05.437495 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_fx_trade_pnl"
[0m01:04:05.443495 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:04:05.444496 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
create or replace transient table dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
         as
        (with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'FX Desk'
),

forex_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        -- and b1.trade_date <= b2.trade_date
        and b1.trade_date = b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        f.close_rate,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity * f.close_rate as pnl_usd
    from matched_trades m
    -- left join forex_metrics f
    join forex_metrics f
        on m.ticker = f.currency_pair_name
        and m.sell_date = f.run_date
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        f.open_rate as day_open,
        f.close_rate as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((f.open_rate - t.price) / f.open_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((f.close_rate - t.price) / f.close_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.close_rate) / f.close_rate) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((f.close_rate - f.open_rate) / f.open_rate) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate then 'Better than open'
                    when t.price > f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate then 'Better than open'
                    when t.price < f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.close_rate then 'Better than close'
                    when t.price > f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.close_rate then 'Better than close'
                    when t.price < f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then 'Best price of day'
                    when t.price > f.open_rate and t.price > f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then 'Best price of day'
                    when t.price < f.open_rate and t.price < f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    else
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    else
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join forex_metrics f
    join forex_metrics f
        on t.ticker = f.currency_pair_name
        and t.trade_date = f.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        );
[0m01:04:05.451973 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.656 seconds
[0m01:04:05.453972 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E091D68C0>]}
[0m01:04:05.454472 [info ] [Thread-2 (]: 2 of 11 OK created sql table model public_01_staging.stg_stock_metrics ......... [[32mSUCCESS 1[0m in 3.25s]
[0m01:04:05.455973 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m01:04:05.456476 [debug] [Thread-1 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m01:04:05.456972 [info ] [Thread-1 (]: 7 of 11 START sql table model public_02_intermediate.int_equity_trade_pnl ...... [RUN]
[0m01:04:05.457973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now model.dbt_project.int_equity_trade_pnl)
[0m01:04:05.458472 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m01:04:05.462472 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m01:04:05.464472 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m01:04:05.466972 [debug] [Thread-1 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL" because it is a view and target relation dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl is of type table.
[0m01:04:05.468973 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:04:05.469974 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:04:05.470472 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL" cascade
[0m01:04:05.737888 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.267 seconds
[0m01:04:05.739887 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.int_equity_trade_pnl"
[0m01:04:05.745888 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:04:05.746388 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
create or replace transient table dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
         as
        (with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'Equity Desk'
),

stock_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        and b1.trade_date <= b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity as pnl_usd  -- Same as pnl since already in USD
    from matched_trades m
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        s.open_price as day_open,
        s.close_price as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((s.open_price - t.price) / s.open_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.open_price) / s.open_price) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((s.close_price - t.price) / s.close_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.close_price) / s.close_price) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((s.close_price - s.open_price) / s.open_price) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price then 'Better than open'
                    when t.price > s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price then 'Better than open'
                    when t.price < s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.close_price then 'Better than close'
                    when t.price > s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.close_price then 'Better than close'
                    when t.price < s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then 'Best price of day'
                    when t.price > s.open_price and t.price > s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then 'Best price of day'
                    when t.price < s.open_price and t.price < s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    else
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    else
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join stock_metrics s
    join stock_metrics s
        on t.ticker = s.ticker
        and t.trade_date = s.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        );
[0m01:04:06.820344 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.375 seconds
[0m01:04:06.822840 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0AB315D0>]}
[0m01:04:06.823843 [info ] [Thread-3 (]: 6 of 11 OK created sql table model public_02_intermediate.int_fx_trade_pnl ..... [[32mSUCCESS 1[0m in 1.64s]
[0m01:04:06.824848 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m01:04:06.912183 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.035 seconds
[0m01:04:06.914683 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0B04BEB0>]}
[0m01:04:06.915686 [info ] [Thread-4 (]: 5 of 11 OK created sql table model public_02_intermediate.int_extracted_entities  [[32mSUCCESS 1[0m in 2.25s]
[0m01:04:06.916684 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_extracted_entities
[0m01:04:06.917682 [debug] [Thread-2 (]: Began running node model.dbt_project.fct_trader_drivers
[0m01:04:06.918684 [info ] [Thread-2 (]: 8 of 11 START sql table model public_03_marts.fct_trader_drivers ............... [RUN]
[0m01:04:06.919683 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now model.dbt_project.fct_trader_drivers)
[0m01:04:06.920183 [debug] [Thread-2 (]: Began compiling node model.dbt_project.fct_trader_drivers
[0m01:04:06.923683 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.fct_trader_drivers"
[0m01:04:06.925184 [debug] [Thread-2 (]: Began executing node model.dbt_project.fct_trader_drivers
[0m01:04:06.928182 [debug] [Thread-2 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS" because it is a view and target relation dbt_hol_2025_dev.public_03_marts.fct_trader_drivers is of type table.
[0m01:04:06.930183 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS"
[0m01:04:06.931183 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:04:06.931685 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS" cascade
[0m01:04:07.090152 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.343 seconds
[0m01:04:07.093153 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0957E440>]}
[0m01:04:07.094153 [info ] [Thread-1 (]: 7 of 11 OK created sql table model public_02_intermediate.int_equity_trade_pnl . [[32mSUCCESS 1[0m in 1.63s]
[0m01:04:07.095154 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m01:04:07.096152 [debug] [Thread-4 (]: Began running node model.dbt_project.int_trade_pnl
[0m01:04:07.096648 [info ] [Thread-4 (]: 9 of 11 START sql table model public_02_intermediate.int_trade_pnl ............. [RUN]
[0m01:04:07.097649 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_trade_pnl)
[0m01:04:07.098149 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m01:04:07.101648 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m01:04:07.103150 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_trade_pnl
[0m01:04:07.106648 [debug] [Thread-4 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL" because it is a view and target relation dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl is of type table.
[0m01:04:07.109148 [debug] [Thread-4 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:04:07.109649 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:04:07.110680 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL" cascade
[0m01:04:07.207053 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.275 seconds
[0m01:04:07.208554 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.fct_trader_drivers"
[0m01:04:07.211052 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:04:07.211554 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
create or replace transient table dbt_hol_2025_dev.public_03_marts.fct_trader_drivers
         as
        (with extracted_entities as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
),

-- Calculate trade driver statistics by trader
trader_driver_stats as (
    select
        trader_name,
        trade_driver,
        count(*) as total_trades,
        array_agg(distinct signal[0]:"answer"::string) as signals_used
    from extracted_entities
    where trade_driver is not null
    group by 1, 2
),

-- Calculate total trades per trader for percentage calculation
trader_totals as (
    select
        trader_name,
        sum(total_trades) as total_trades
    from trader_driver_stats
    group by 1
),

-- Combine statistics with percentages
final_stats as (
    select
        tds.trader_name,
        tds.trade_driver,
        tds.total_trades,
        tds.signals_used,
        round(tds.total_trades * 100.0 / nullif(tt.total_trades, 0), 2) as driver_percentage
    from trader_driver_stats tds
    join trader_totals tt
        on tds.trader_name = tt.trader_name
)

select * from final_stats
order by trader_name, total_trades desc
        );
[0m01:04:07.274565 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.164 seconds
[0m01:04:07.276065 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_trade_pnl"
[0m01:04:07.278323 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:04:07.279316 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
create or replace transient table dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
         as
        (with equity_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
),

fx_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
)

select * from equity_trades
union all
select * from fx_trades
        );
[0m01:04:08.039904 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.828 seconds
[0m01:04:08.042405 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0B043820>]}
[0m01:04:08.042904 [info ] [Thread-2 (]: 8 of 11 OK created sql table model public_03_marts.fct_trader_drivers .......... [[32mSUCCESS 1[0m in 1.12s]
[0m01:04:08.044405 [debug] [Thread-2 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m01:04:08.209942 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.930 seconds
[0m01:04:08.211942 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0B047D00>]}
[0m01:04:08.212942 [info ] [Thread-4 (]: 9 of 11 OK created sql table model public_02_intermediate.int_trade_pnl ........ [[32mSUCCESS 1[0m in 1.11s]
[0m01:04:08.214080 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_trade_pnl
[0m01:04:08.215567 [debug] [Thread-1 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m01:04:08.216066 [info ] [Thread-1 (]: 10 of 11 START sql table model public_03_marts.fct_pnl_by_desk ................. [RUN]
[0m01:04:08.217065 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_equity_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m01:04:08.217565 [debug] [Thread-1 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m01:04:08.221565 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m01:04:08.223566 [debug] [Thread-1 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m01:04:08.226565 [debug] [Thread-1 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK" because it is a view and target relation dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk is of type table.
[0m01:04:08.229065 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK"
[0m01:04:08.230066 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:04:08.230566 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK" cascade
[0m01:04:08.380721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.150 seconds
[0m01:04:08.382221 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_by_desk"
[0m01:04:08.385721 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:04:08.386722 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
create or replace transient table dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
         as
        (with trade_performance as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
),

-- Calculate daily P&L metrics by desk and ticker
daily_desk_metrics as (
    select
        p.desk,
        p.ticker,
        p.sell_date as trade_date,
        case 
            when p.ticker like '%/%' then 'Europe'
            else 'North America'
        end as region,
        count(distinct p.buy_trade_id) as total_trades,
        sum(p.quantity) as total_quantity,
        sum(p.pnl_usd) as total_pnl_usd,
        avg(p.quantity) as avg_trade_size,
        avg(p.pnl_usd) as avg_pnl_usd,
        -- Add trading performance metrics
        avg(p.vs_open_performance_pct) as avg_vs_open_performance_pct,
        avg(p.vs_close_performance_pct) as avg_vs_close_performance_pct,
        avg(p.market_daily_performance_pct) as avg_market_performance_pct,
        avg(p.relative_performance_pct) as avg_relative_performance_pct,
        count(case when p.price_performance = 'Best price of day' then 1 end) as best_price_trades,
        count(case when p.price_performance = 'Worst price of day' then 1 end) as worst_price_trades,
        count(case when p.price_performance = 'Middle price of day' then 1 end) as middle_price_trades
    from trade_performance p
    where p.buy_trade_id is not null  -- Only include matched trades
    group by 1, 2, 3, 4
),

-- Calculate cumulative metrics
cumulative_metrics as (
    select
        desk,
        ticker,
        trade_date,
        region,
        total_trades,
        total_quantity,
        total_pnl_usd,
        avg_trade_size,
        avg_pnl_usd,
        avg_vs_open_performance_pct,
        avg_vs_close_performance_pct,
        avg_market_performance_pct,
        avg_relative_performance_pct,
        best_price_trades,
        worst_price_trades,
        middle_price_trades,
        sum(total_pnl_usd) over (partition by desk, ticker order by trade_date) as cumulative_pnl_usd
    from daily_desk_metrics
)

select * from cumulative_metrics
        );
[0m01:04:09.424959 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.038 seconds
[0m01:04:09.427458 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E091B7F70>]}
[0m01:04:09.428457 [info ] [Thread-1 (]: 10 of 11 OK created sql table model public_03_marts.fct_pnl_by_desk ............ [[32mSUCCESS 1[0m in 1.21s]
[0m01:04:09.429458 [debug] [Thread-1 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m01:04:09.429957 [debug] [Thread-2 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m01:04:09.430959 [info ] [Thread-2 (]: 11 of 11 START sql table model public_03_marts.fct_pnl_vs_target ............... [RUN]
[0m01:04:09.431957 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.fct_trader_drivers, now model.dbt_project.fct_pnl_vs_target)
[0m01:04:09.432458 [debug] [Thread-2 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m01:04:09.436457 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m01:04:09.438457 [debug] [Thread-2 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m01:04:09.442458 [debug] [Thread-2 (]:  adapter: Dropping relation "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET" because it is a view and target relation dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target is of type table.
[0m01:04:09.445463 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET"
[0m01:04:09.446458 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:04:09.446956 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
drop view if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET" cascade
[0m01:04:09.679039 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.231 seconds
[0m01:04:09.681039 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_vs_target"
[0m01:04:09.684844 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:04:09.685345 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
create or replace transient table dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target
         as
        (with pnl_by_desk as (
    select * from dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
),

weights as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_weights
),

-- Calculate total portfolio value by desk and region
portfolio_value as (
    select
        trade_date,
        desk,
        region,
        sum(total_pnl_usd) as portfolio_value_usd,
        avg(avg_vs_open_performance_pct) as portfolio_vs_open_performance,
        avg(avg_vs_close_performance_pct) as portfolio_vs_close_performance,
        avg(avg_market_performance_pct) as portfolio_market_performance,
        avg(avg_relative_performance_pct) as portfolio_relative_performance,
        sum(best_price_trades) as total_best_price_trades,
        sum(worst_price_trades) as total_worst_price_trades,
        sum(middle_price_trades) as total_middle_price_trades
    from pnl_by_desk
    group by 1, 2, 3
),

-- Calculate total portfolio value across all desks and regions for each date
total_portfolio_value as (
    select
        trade_date,
        sum(portfolio_value_usd) as total_portfolio_value_usd
    from portfolio_value
    group by 1
),

-- Calculate actual allocations and compare with targets
allocation_variance as (
    select
        pv.trade_date,
        pv.desk,
        pv.region,
        w.target_allocation,
        pv.portfolio_value_usd,
        tp.total_portfolio_value_usd,
        pv.portfolio_vs_open_performance,
        pv.portfolio_vs_close_performance,
        pv.portfolio_market_performance,
        pv.portfolio_relative_performance,
        pv.total_best_price_trades,
        pv.total_worst_price_trades,
        pv.total_middle_price_trades,
        pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) as actual_allocation,
        (pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) - w.target_allocation) as allocation_variance,
        case
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) > w.target_allocation then 'Overweight'
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) < w.target_allocation then 'Underweight'
            else 'On Target'
        end as allocation_status
    from portfolio_value pv
    join total_portfolio_value tp
        on pv.trade_date = tp.trade_date
    join weights w
        on pv.desk = w.desk
        and pv.region = w.region
)

select * from allocation_variance
        );
[0m01:04:10.703781 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.018 seconds
[0m01:04:10.706782 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb17cc8f-81b8-4bdf-b4a8-00565b7af851', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E0913F940>]}
[0m01:04:10.707785 [info ] [Thread-2 (]: 11 of 11 OK created sql table model public_03_marts.fct_pnl_vs_target .......... [[32mSUCCESS 1[0m in 1.27s]
[0m01:04:10.708781 [debug] [Thread-2 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m01:04:10.710283 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:04:10.710782 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:04:10.711783 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:04:10.821767 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:04:10.822268 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:04:10.927320 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:04:10.928331 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:04:11.059245 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m01:04:11.060248 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m01:04:11.178817 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m01:04:11.179817 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m01:04:11.307134 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m01:04:11.307635 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m01:04:11.444712 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m01:04:11.445737 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m01:04:11.542916 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was left open.
[0m01:04:11.543415 [debug] [MainThread]: On model.dbt_project.fct_pnl_by_desk: Close
[0m01:04:11.640834 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was left open.
[0m01:04:11.641828 [debug] [MainThread]: On model.dbt_project.fct_pnl_vs_target: Close
[0m01:04:11.793740 [debug] [MainThread]: Connection 'model.dbt_project.int_fx_trade_pnl' was left open.
[0m01:04:11.794740 [debug] [MainThread]: On model.dbt_project.int_fx_trade_pnl: Close
[0m01:04:11.931985 [debug] [MainThread]: Connection 'model.dbt_project.int_trade_pnl' was left open.
[0m01:04:11.932485 [debug] [MainThread]: On model.dbt_project.int_trade_pnl: Close
[0m01:04:12.058654 [info ] [MainThread]: 
[0m01:04:12.059656 [info ] [MainThread]: Finished running 11 table models in 0 hours 0 minutes and 12.81 seconds (12.81s).
[0m01:04:12.061654 [debug] [MainThread]: Command end result
[0m01:04:12.167156 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:04:12.170157 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:04:12.178654 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m01:04:12.179157 [info ] [MainThread]: 
[0m01:04:12.179656 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:04:12.180655 [info ] [MainThread]: 
[0m01:04:12.181155 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m01:04:12.182655 [debug] [MainThread]: Command `dbt run` succeeded at 01:04:12.182157 after 16.34 seconds
[0m01:04:12.183157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E676CAE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E09870550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000015E09849810>]}
[0m01:04:12.183657 [debug] [MainThread]: Flushing usage events
[0m01:04:12.544296 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:17:56.218192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029828DB6E30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029829CAB160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029829CA9C00>]}


============================== 01:17:56.221691 | 96402fe5-d5aa-44f6-aae0-054c2da79a56 ==============================
[0m01:17:56.221691 [info ] [MainThread]: Running with dbt=1.9.4
[0m01:17:56.222194 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:17:57.191695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984A763040>]}
[0m01:17:57.260695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000298297F1E10>]}
[0m01:17:57.262195 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m01:17:57.643696 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m01:17:57.828202 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m01:17:57.829196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000298297F3C10>]}
[0m01:17:59.312701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C201B40>]}
[0m01:17:59.513206 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:17:59.516705 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:17:59.542704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984AF0ABF0>]}
[0m01:17:59.543704 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m01:17:59.544205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984AF0BEE0>]}
[0m01:17:59.546204 [info ] [MainThread]: 
[0m01:17:59.547204 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:17:59.547703 [info ] [MainThread]: 
[0m01:17:59.548704 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:17:59.556206 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:17:59.563206 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:17:59.571262 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:17:59.707203 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:17:59.707702 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:17:59.708207 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:17:59.709202 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:17:59.709706 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:17:59.710205 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:17:59.710702 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:59.711206 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:17:59.711705 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:00.323683 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.613 seconds
[0m01:18:00.325185 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.614 seconds
[0m01:18:00.327684 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.617 seconds
[0m01:18:00.332185 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m01:18:00.333184 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m01:18:00.343687 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:18:00.344186 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m01:18:00.345184 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m01:18:00.347684 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:18:00.348187 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m01:18:00.350683 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:18:00.353684 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:18:00.354185 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m01:18:00.354844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:00.355187 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m01:18:00.355684 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m01:18:00.356184 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:00.357187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:00.358684 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:18:00.796884 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.440 seconds
[0m01:18:00.797384 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:18:00.797884 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:18:00.813941 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.455 seconds
[0m01:18:00.814444 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.458 seconds
[0m01:18:00.814945 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:18:00.815960 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:18:00.816442 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:18:00.816943 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:18:00.853005 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.498 seconds
[0m01:18:00.854007 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:18:00.854507 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:18:02.409081 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.554 seconds
[0m01:18:02.409582 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.591 seconds
[0m01:18:02.412582 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.614 seconds
[0m01:18:02.419080 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.601 seconds
[0m01:18:02.422581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984BF3D420>]}
[0m01:18:02.428582 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m01:18:02.428582 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m01:18:02.429580 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m01:18:02.429580 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m01:18:02.430584 [info ] [Thread-1 (]: 1 of 11 START sql table model public_01_staging.stg_forex_metrics .............. [RUN]
[0m01:18:02.431082 [info ] [Thread-2 (]: 2 of 11 START sql table model public_01_staging.stg_stock_metrics .............. [RUN]
[0m01:18:02.432082 [info ] [Thread-3 (]: 3 of 11 START sql table model public_01_staging.stg_trading_books .............. [RUN]
[0m01:18:02.432581 [info ] [Thread-4 (]: 4 of 11 START sql table model public_01_staging.stg_weights .................... [RUN]
[0m01:18:02.433581 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m01:18:02.434081 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m01:18:02.435084 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m01:18:02.435581 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m01:18:02.436082 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m01:18:02.436586 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m01:18:02.437082 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m01:18:02.438083 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m01:18:02.446082 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m01:18:02.449081 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m01:18:02.452081 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m01:18:02.456580 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m01:18:02.458582 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m01:18:02.459082 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m01:18:02.459580 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m01:18:02.484581 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m01:18:02.495583 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.stg_forex_metrics"
[0m01:18:02.502082 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.stg_stock_metrics"
[0m01:18:02.505081 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.stg_trading_books"
[0m01:18:02.508080 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.stg_weights"
[0m01:18:02.510085 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m01:18:02.511083 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m01:18:02.511583 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_forex_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
         as
        (with source as (
    select * from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.STOCK.FOREX_METRICS
),
renamed as (
    select
        run_date,
        currency_pair_name,
        open as open_rate,
        high as high_rate,
        low as low_rate,
        close as close_rate
    from source   
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:18:02.512581 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m01:18:02.513081 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m01:18:02.513580 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_stock_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
         as
        (with source as (
    select * from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.STOCK.US_STOCK_METRICS
),

renamed as (
    select
        run_date,
        ticker,
        open as open_price,
        high as high_price,
        low as low_price,
        close as close_price,
        volume
    from source
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:18:02.514081 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:18:02.515083 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_trading_books"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_trading_books
         as
        (with source as (
    select * from dbt_hol_2025_dev.public.trading_books
),

renamed as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes
    from source
)

select * from renamed
        );
[0m01:18:02.515581 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_weights"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_weights
         as
        (with source as (
    select *
    from dbt_hol_2025_dev.public.weights_table
),
renamed as (
    select region,
        desk,
        target_allocation
    from source
)
select *
from renamed
        );
[0m01:18:02.516082 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:18:02.517085 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:18:02.519085 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:18:03.661728 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.145 seconds
[0m01:18:03.685229 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984A7BF9A0>]}
[0m01:18:03.686228 [info ] [Thread-3 (]: 3 of 11 OK created sql table model public_01_staging.stg_trading_books ......... [[32mSUCCESS 1[0m in 1.25s]
[0m01:18:03.687296 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m01:18:03.688285 [debug] [Thread-3 (]: Began running node model.dbt_project.int_extracted_entities
[0m01:18:03.688784 [info ] [Thread-3 (]: 5 of 11 START sql dynamic_table model public_02_intermediate.int_extracted_entities  [RUN]
[0m01:18:03.689287 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now model.dbt_project.int_extracted_entities)
[0m01:18:03.689786 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m01:18:03.692784 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m01:18:03.694200 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_extracted_entities
[0m01:18:03.696224 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:03.696713 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
select current_warehouse() as warehouse
[0m01:18:03.810789 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.291 seconds
[0m01:18:03.813290 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984BFEE740>]}
[0m01:18:03.813790 [info ] [Thread-4 (]: 4 of 11 OK created sql table model public_01_staging.stg_weights ............... [[32mSUCCESS 1[0m in 1.38s]
[0m01:18:03.815292 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m01:18:03.832669 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m01:18:03.834669 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:03.835171 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL
[0m01:18:03.929332 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.094 seconds
[0m01:18:03.945816 [debug] [Thread-3 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES"
[0m01:18:03.953820 [debug] [Thread-3 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES"
[0m01:18:03.959317 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES__dbt_backup"
[0m01:18:03.965317 [debug] [Thread-3 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES"
[0m01:18:03.970817 [debug] [Thread-3 (]: Applying CREATE to: dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
[0m01:18:03.977817 [debug] [Thread-3 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES"
[0m01:18:03.979816 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES__dbt_backup"
[0m01:18:03.982819 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_extracted_entities"
[0m01:18:03.985318 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:03.985816 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES__dbt_backup" cascade

    

;
[0m01:18:04.083954 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.097 seconds
[0m01:18:04.084954 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:04.085456 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES" rename to "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EXTRACTED_ENTITIES__dbt_backup";
[0m01:18:04.197728 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.112 seconds
[0m01:18:04.198728 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:04.199228 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
create dynamic table dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
),

-- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
cst as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes,
        SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
        SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
        SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
    from trading_books
    where notes is not null
)
select * from cst
        )

    

;
[0m01:18:04.452498 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01bbb87e-020d-0cc1-000d-306b000492e6
[0m01:18:04.452993 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 091940 (0A000): SQL compilation error: line 0 at position -1:
Query contains the function 'SENTIMENT$V2', but change tracking is not supported on queries with non-IMMUTABLE user-defined functions.
[0m01:18:04.453991 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:18:04.454491 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:04.571119 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.116 seconds
[0m01:18:04.575168 [debug] [Thread-3 (]: Database Error in model int_extracted_entities (models\intermediate\int_extracted_entities.sql)
  091940 (0A000): SQL compilation error: line 0 at position -1:
  Query contains the function 'SENTIMENT$V2', but change tracking is not supported on queries with non-IMMUTABLE user-defined functions.
  compiled code at target\run\dbt_project\models\intermediate\int_extracted_entities.sql
[0m01:18:04.575669 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029828C655D0>]}
[0m01:18:04.576670 [error] [Thread-3 (]: 5 of 11 ERROR creating sql dynamic_table model public_02_intermediate.int_extracted_entities  [[31mERROR[0m in 0.89s]
[0m01:18:04.577669 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_extracted_entities
[0m01:18:04.578670 [debug] [Thread-7 (]: Marking all children of 'model.dbt_project.int_extracted_entities' to be skipped because of status 'error'.  Reason: Database Error in model int_extracted_entities (models\intermediate\int_extracted_entities.sql)
  091940 (0A000): SQL compilation error: line 0 at position -1:
  Query contains the function 'SENTIMENT$V2', but change tracking is not supported on queries with non-IMMUTABLE user-defined functions.
  compiled code at target\run\dbt_project\models\intermediate\int_extracted_entities.sql.
[0m01:18:04.579668 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_trader_drivers
[0m01:18:04.580668 [info ] [Thread-4 (]: 6 of 11 SKIP relation public_03_marts.fct_trader_drivers ....................... [[33mSKIP[0m]
[0m01:18:04.581168 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m01:18:04.736411 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.222 seconds
[0m01:18:04.738412 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C0D2E60>]}
[0m01:18:04.739411 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_01_staging.stg_forex_metrics ......... [[32mSUCCESS 1[0m in 2.31s]
[0m01:18:04.740411 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m01:18:04.741413 [debug] [Thread-3 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m01:18:04.742410 [info ] [Thread-3 (]: 7 of 11 START sql dynamic_table model public_02_intermediate.int_fx_trade_pnl .. [RUN]
[0m01:18:04.743411 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_fx_trade_pnl)
[0m01:18:04.743912 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m01:18:04.748414 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m01:18:04.750413 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m01:18:04.752910 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:04.753413 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:18:04.837412 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m01:18:04.840912 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:04.841910 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:18:04.964913 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.123 seconds
[0m01:18:04.966911 [debug] [Thread-3 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:18:04.967911 [debug] [Thread-3 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:18:04.968411 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL__dbt_backup"
[0m01:18:04.969411 [debug] [Thread-3 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:18:04.970410 [debug] [Thread-3 (]: Applying CREATE to: dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
[0m01:18:04.971415 [debug] [Thread-3 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:18:04.972414 [debug] [Thread-3 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL__dbt_backup"
[0m01:18:04.973414 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_fx_trade_pnl"
[0m01:18:04.980414 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:04.980914 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL__dbt_backup" cascade

    

;
[0m01:18:05.091205 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.109 seconds
[0m01:18:05.092205 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:05.092705 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL" rename to "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL__dbt_backup";
[0m01:18:05.300911 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.207 seconds
[0m01:18:05.301409 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:05.302409 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
create dynamic table dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'FX Desk'
),

forex_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        -- and b1.trade_date <= b2.trade_date
        and b1.trade_date = b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        f.close_rate,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity * f.close_rate as pnl_usd
    from matched_trades m
    -- left join forex_metrics f
    join forex_metrics f
        on m.ticker = f.currency_pair_name
        and m.sell_date = f.run_date
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        f.open_rate as day_open,
        f.close_rate as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((f.open_rate - t.price) / f.open_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((f.close_rate - t.price) / f.close_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.close_rate) / f.close_rate) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((f.close_rate - f.open_rate) / f.open_rate) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate then 'Better than open'
                    when t.price > f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate then 'Better than open'
                    when t.price < f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.close_rate then 'Better than close'
                    when t.price > f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.close_rate then 'Better than close'
                    when t.price < f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then 'Best price of day'
                    when t.price > f.open_rate and t.price > f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then 'Best price of day'
                    when t.price < f.open_rate and t.price < f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    else
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    else
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join forex_metrics f
    join forex_metrics f
        on t.ticker = f.currency_pair_name
        and t.trade_date = f.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        )

    

;
[0m01:18:05.526577 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.010 seconds
[0m01:18:05.529076 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984D7799C0>]}
[0m01:18:05.530077 [info ] [Thread-2 (]: 2 of 11 OK created sql table model public_01_staging.stg_stock_metrics ......... [[32mSUCCESS 1[0m in 3.09s]
[0m01:18:05.531578 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m01:18:05.532576 [debug] [Thread-1 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m01:18:05.533076 [info ] [Thread-1 (]: 8 of 11 START sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [RUN]
[0m01:18:05.534077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now model.dbt_project.int_equity_trade_pnl)
[0m01:18:05.534577 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m01:18:05.538576 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.540577 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m01:18:05.543076 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.543576 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:18:05.624711 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m01:18:05.626211 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.626712 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:18:05.716781 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m01:18:05.719781 [debug] [Thread-1 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:18:05.720781 [debug] [Thread-1 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:18:05.721780 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL__dbt_backup"
[0m01:18:05.722280 [debug] [Thread-1 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:18:05.723280 [debug] [Thread-1 (]: Applying CREATE to: dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
[0m01:18:05.724281 [debug] [Thread-1 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:18:05.725280 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL__dbt_backup"
[0m01:18:05.726280 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.732280 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.732780 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL__dbt_backup" cascade

    

;
[0m01:18:05.837024 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.103 seconds
[0m01:18:05.837524 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.838525 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL" rename to "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL__dbt_backup";
[0m01:18:05.971845 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.133 seconds
[0m01:18:05.972845 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:05.973846 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
create dynamic table dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
    where desk = 'Equity Desk'
),

stock_metrics as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        and b1.trade_date <= b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity as pnl_usd  -- Same as pnl since already in USD
    from matched_trades m
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        s.open_price as day_open,
        s.close_price as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((s.open_price - t.price) / s.open_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.open_price) / s.open_price) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((s.close_price - t.price) / s.close_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.close_price) / s.close_price) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((s.close_price - s.open_price) / s.open_price) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price then 'Better than open'
                    when t.price > s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price then 'Better than open'
                    when t.price < s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.close_price then 'Better than close'
                    when t.price > s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.close_price then 'Better than close'
                    when t.price < s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then 'Best price of day'
                    when t.price > s.open_price and t.price > s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then 'Best price of day'
                    when t.price < s.open_price and t.price < s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    else
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    else
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join stock_metrics s
    join stock_metrics s
        on t.ticker = s.ticker
        and t.trade_date = s.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        )

    

;
[0m01:18:08.784034 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.809 seconds
[0m01:18:08.785035 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:08.785541 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL__dbt_backup" cascade
[0m01:18:08.957139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.171 seconds
[0m01:18:08.959639 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:18:08.960140 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:09.062315 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.102 seconds
[0m01:18:09.064800 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C693D90>]}
[0m01:18:09.065300 [info ] [Thread-1 (]: 8 of 11 OK created sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [[32mSUCCESS 1[0m in 3.53s]
[0m01:18:09.066513 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m01:18:09.122924 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.820 seconds
[0m01:18:09.123922 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:09.124423 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL__dbt_backup" cascade
[0m01:18:09.259705 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.135 seconds
[0m01:18:09.261705 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:18:09.262204 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:09.390709 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.128 seconds
[0m01:18:09.392709 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C628A90>]}
[0m01:18:09.393711 [info ] [Thread-3 (]: 7 of 11 OK created sql dynamic_table model public_02_intermediate.int_fx_trade_pnl  [[32mSUCCESS 1[0m in 4.65s]
[0m01:18:09.395210 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m01:18:09.396207 [debug] [Thread-2 (]: Began running node model.dbt_project.int_trade_pnl
[0m01:18:09.397205 [info ] [Thread-2 (]: 9 of 11 START sql dynamic_table model public_02_intermediate.int_trade_pnl ..... [RUN]
[0m01:18:09.398208 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now model.dbt_project.int_trade_pnl)
[0m01:18:09.398708 [debug] [Thread-2 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m01:18:09.402709 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m01:18:09.404912 [debug] [Thread-2 (]: Began executing node model.dbt_project.int_trade_pnl
[0m01:18:09.407911 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:09.408410 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:18:09.497528 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.088 seconds
[0m01:18:09.499029 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:09.499528 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:18:09.633426 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.133 seconds
[0m01:18:09.635925 [debug] [Thread-2 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:18:09.636425 [debug] [Thread-2 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:18:09.637427 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL__dbt_backup"
[0m01:18:09.638427 [debug] [Thread-2 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:18:09.638925 [debug] [Thread-2 (]: Applying CREATE to: dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
[0m01:18:09.639927 [debug] [Thread-2 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:18:09.640926 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL__dbt_backup"
[0m01:18:09.641927 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.int_trade_pnl"
[0m01:18:09.644426 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:09.645427 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL__dbt_backup" cascade

    

;
[0m01:18:09.736548 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.091 seconds
[0m01:18:09.737563 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:09.738049 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL" rename to "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL__dbt_backup";
[0m01:18:09.834255 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m01:18:09.835254 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:09.835754 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
create dynamic table dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with equity_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_equity_trade_pnl
),

fx_trades as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_fx_trade_pnl
)

select * from equity_trades
union all
select * from fx_trades
        )

    

;
[0m01:18:12.952075 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.116 seconds
[0m01:18:12.953078 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:12.953579 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL__dbt_backup" cascade
[0m01:18:13.096695 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.142 seconds
[0m01:18:13.098695 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:18:13.099680 [debug] [Thread-2 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:13.166200 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.066 seconds
[0m01:18:13.168199 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C628A90>]}
[0m01:18:13.169199 [info ] [Thread-2 (]: 9 of 11 OK created sql dynamic_table model public_02_intermediate.int_trade_pnl  [[32mSUCCESS 1[0m in 3.77s]
[0m01:18:13.170201 [debug] [Thread-2 (]: Finished running node model.dbt_project.int_trade_pnl
[0m01:18:13.171201 [debug] [Thread-1 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m01:18:13.172199 [info ] [Thread-1 (]: 10 of 11 START sql dynamic_table model public_03_marts.fct_pnl_by_desk ......... [RUN]
[0m01:18:13.173201 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_equity_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m01:18:13.173700 [debug] [Thread-1 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m01:18:13.177199 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.178700 [debug] [Thread-1 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m01:18:13.181199 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.181699 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
select current_warehouse() as warehouse
[0m01:18:13.259882 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.077 seconds
[0m01:18:13.261374 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.262373 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL
[0m01:18:13.406973 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.144 seconds
[0m01:18:13.408973 [debug] [Thread-1 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK"
[0m01:18:13.409973 [debug] [Thread-1 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK"
[0m01:18:13.410473 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK__dbt_backup"
[0m01:18:13.411473 [debug] [Thread-1 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK"
[0m01:18:13.412459 [debug] [Thread-1 (]: Applying CREATE to: dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
[0m01:18:13.413459 [debug] [Thread-1 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK"
[0m01:18:13.414458 [debug] [Thread-1 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK__dbt_backup"
[0m01:18:13.414958 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.418958 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.419458 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK__dbt_backup" cascade

    

;
[0m01:18:13.560128 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.140 seconds
[0m01:18:13.560628 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.561628 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK" rename to "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK__dbt_backup";
[0m01:18:13.700191 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.138 seconds
[0m01:18:13.701194 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:13.702207 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
create dynamic table dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trade_performance as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_trade_pnl
),

-- Calculate daily P&L metrics by desk and ticker
daily_desk_metrics as (
    select
        p.desk,
        p.ticker,
        p.sell_date as trade_date,
        case 
            when p.ticker like '%/%' then 'Europe'
            else 'North America'
        end as region,
        count(distinct p.buy_trade_id) as total_trades,
        sum(p.quantity) as total_quantity,
        sum(p.pnl_usd) as total_pnl_usd,
        avg(p.quantity) as avg_trade_size,
        avg(p.pnl_usd) as avg_pnl_usd,
        -- Add trading performance metrics
        avg(p.vs_open_performance_pct) as avg_vs_open_performance_pct,
        avg(p.vs_close_performance_pct) as avg_vs_close_performance_pct,
        avg(p.market_daily_performance_pct) as avg_market_performance_pct,
        avg(p.relative_performance_pct) as avg_relative_performance_pct,
        count(case when p.price_performance = 'Best price of day' then 1 end) as best_price_trades,
        count(case when p.price_performance = 'Worst price of day' then 1 end) as worst_price_trades,
        count(case when p.price_performance = 'Middle price of day' then 1 end) as middle_price_trades
    from trade_performance p
    where p.buy_trade_id is not null  -- Only include matched trades
    group by 1, 2, 3, 4
),

-- Calculate cumulative metrics
cumulative_metrics as (
    select
        desk,
        ticker,
        trade_date,
        region,
        total_trades,
        total_quantity,
        total_pnl_usd,
        avg_trade_size,
        avg_pnl_usd,
        avg_vs_open_performance_pct,
        avg_vs_close_performance_pct,
        avg_market_performance_pct,
        avg_relative_performance_pct,
        best_price_trades,
        worst_price_trades,
        middle_price_trades,
        sum(total_pnl_usd) over (partition by desk, ticker order by trade_date) as cumulative_pnl_usd
    from daily_desk_metrics
)

select * from cumulative_metrics
        )

    

;
[0m01:18:17.840776 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.138 seconds
[0m01:18:17.841773 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:17.842273 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_BY_DESK__dbt_backup" cascade
[0m01:18:18.027739 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.185 seconds
[0m01:18:18.029739 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:18:18.030741 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:18.147967 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m01:18:18.150455 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C696FB0>]}
[0m01:18:18.150954 [info ] [Thread-1 (]: 10 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_by_desk .... [[32mSUCCESS 1[0m in 4.98s]
[0m01:18:18.152457 [debug] [Thread-1 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m01:18:18.153456 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m01:18:18.154455 [info ] [Thread-4 (]: 11 of 11 START sql dynamic_table model public_03_marts.fct_pnl_vs_target ....... [RUN]
[0m01:18:18.155457 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now model.dbt_project.fct_pnl_vs_target)
[0m01:18:18.155958 [debug] [Thread-4 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m01:18:18.159454 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.161456 [debug] [Thread-4 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m01:18:18.163455 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.164455 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
select current_warehouse() as warehouse
[0m01:18:18.244847 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m01:18:18.246848 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.247349 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL
[0m01:18:18.337219 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m01:18:18.339706 [debug] [Thread-4 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET"
[0m01:18:18.340206 [debug] [Thread-4 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET"
[0m01:18:18.341206 [debug] [Thread-4 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET__dbt_backup"
[0m01:18:18.342206 [debug] [Thread-4 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET"
[0m01:18:18.343206 [debug] [Thread-4 (]: Applying CREATE to: dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target
[0m01:18:18.344208 [debug] [Thread-4 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET"
[0m01:18:18.345706 [debug] [Thread-4 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET__dbt_backup"
[0m01:18:18.346707 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.351207 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.351706 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET__dbt_backup" cascade

    

;
[0m01:18:18.434461 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m01:18:18.435461 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.436466 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET" rename to "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET__dbt_backup";
[0m01:18:18.528266 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.092 seconds
[0m01:18:18.529263 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:18.530267 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
create dynamic table dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with pnl_by_desk as (
    select * from dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk
),

weights as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_weights
),

-- Calculate total portfolio value by desk and region
portfolio_value as (
    select
        trade_date,
        desk,
        region,
        sum(total_pnl_usd) as portfolio_value_usd,
        avg(avg_vs_open_performance_pct) as portfolio_vs_open_performance,
        avg(avg_vs_close_performance_pct) as portfolio_vs_close_performance,
        avg(avg_market_performance_pct) as portfolio_market_performance,
        avg(avg_relative_performance_pct) as portfolio_relative_performance,
        sum(best_price_trades) as total_best_price_trades,
        sum(worst_price_trades) as total_worst_price_trades,
        sum(middle_price_trades) as total_middle_price_trades
    from pnl_by_desk
    group by 1, 2, 3
),

-- Calculate total portfolio value across all desks and regions for each date
total_portfolio_value as (
    select
        trade_date,
        sum(portfolio_value_usd) as total_portfolio_value_usd
    from portfolio_value
    group by 1
),

-- Calculate actual allocations and compare with targets
allocation_variance as (
    select
        pv.trade_date,
        pv.desk,
        pv.region,
        w.target_allocation,
        pv.portfolio_value_usd,
        tp.total_portfolio_value_usd,
        pv.portfolio_vs_open_performance,
        pv.portfolio_vs_close_performance,
        pv.portfolio_market_performance,
        pv.portfolio_relative_performance,
        pv.total_best_price_trades,
        pv.total_worst_price_trades,
        pv.total_middle_price_trades,
        pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) as actual_allocation,
        (pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) - w.target_allocation) as allocation_variance,
        case
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) > w.target_allocation then 'Overweight'
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) < w.target_allocation then 'Underweight'
            else 'On Target'
        end as allocation_status
    from portfolio_value pv
    join total_portfolio_value tp
        on pv.trade_date = tp.trade_date
    join weights w
        on pv.desk = w.desk
        and pv.region = w.region
)

select * from allocation_variance
        )

    

;
[0m01:18:23.282827 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 4.752 seconds
[0m01:18:23.283327 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:23.284329 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_PNL_VS_TARGET__dbt_backup" cascade
[0m01:18:23.431739 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.147 seconds
[0m01:18:23.433737 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:18:23.434738 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:18:23.530972 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.095 seconds
[0m01:18:23.535624 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96402fe5-d5aa-44f6-aae0-054c2da79a56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984C628A90>]}
[0m01:18:23.536624 [info ] [Thread-4 (]: 11 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_vs_target .. [[32mSUCCESS 1[0m in 5.38s]
[0m01:18:23.537627 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m01:18:23.539127 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:18:23.539624 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:18:23.540125 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:18:23.739412 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:18:23.740398 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:18:23.857789 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:18:23.858289 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:18:23.974956 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m01:18:23.975965 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m01:18:24.084999 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m01:18:24.085486 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m01:18:24.184728 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m01:18:24.185728 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m01:18:24.295000 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m01:18:24.295500 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m01:18:24.395788 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was left open.
[0m01:18:24.396288 [debug] [MainThread]: On model.dbt_project.fct_pnl_by_desk: Close
[0m01:18:24.541581 [debug] [MainThread]: Connection 'model.dbt_project.int_trade_pnl' was left open.
[0m01:18:24.542567 [debug] [MainThread]: On model.dbt_project.int_trade_pnl: Close
[0m01:18:24.686479 [debug] [MainThread]: Connection 'model.dbt_project.int_fx_trade_pnl' was left open.
[0m01:18:24.686982 [debug] [MainThread]: On model.dbt_project.int_fx_trade_pnl: Close
[0m01:18:24.822071 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was left open.
[0m01:18:24.822571 [debug] [MainThread]: On model.dbt_project.fct_pnl_vs_target: Close
[0m01:18:24.980499 [info ] [MainThread]: 
[0m01:18:24.981501 [info ] [MainThread]: Finished running 7 dynamic table models, 4 table models in 0 hours 0 minutes and 25.43 seconds (25.43s).
[0m01:18:24.983999 [debug] [MainThread]: Command end result
[0m01:18:25.011500 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:18:25.014499 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:18:25.022499 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m01:18:25.023000 [info ] [MainThread]: 
[0m01:18:25.024000 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:18:25.024501 [info ] [MainThread]: 
[0m01:18:25.025000 [error] [MainThread]:   Database Error in model int_extracted_entities (models\intermediate\int_extracted_entities.sql)
  091940 (0A000): SQL compilation error: line 0 at position -1:
  Query contains the function 'SENTIMENT$V2', but change tracking is not supported on queries with non-IMMUTABLE user-defined functions.
  compiled code at target\run\dbt_project\models\intermediate\int_extracted_entities.sql
[0m01:18:25.025999 [info ] [MainThread]: 
[0m01:18:25.026510 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=1 TOTAL=11
[0m01:18:25.027999 [debug] [MainThread]: Command `dbt run` failed at 01:18:25.027999 after 28.92 seconds
[0m01:18:25.028499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000029828DB6E30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984BF4BDF0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002984BF4BD00>]}
[0m01:18:25.028999 [debug] [MainThread]: Flushing usage events
[0m01:18:25.413767 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:24:52.381331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141BFFFAE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141C0D7B820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141C0D79420>]}


============================== 01:24:52.384831 | 9158a8e2-fbad-4477-9be2-6cfcf661a989 ==============================
[0m01:24:52.384831 [info ] [MainThread]: Running with dbt=1.9.4
[0m01:24:52.385833 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:24:53.323834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141C0A60460>]}
[0m01:24:53.393344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E195C4F0>]}
[0m01:24:53.394910 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m01:24:53.779835 [debug] [MainThread]: checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c, vars: {}, profile: , target: , version: 1.9.4
[0m01:24:54.055836 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m01:24:54.056839 [debug] [MainThread]: Partial parsing: updated file: dbt_project://models\intermediate\int_extracted_entities.sql
[0m01:24:54.057336 [debug] [MainThread]: Partial parsing: updated file: dbt_project://models\marts\fct_trader_drivers.sql
[0m01:24:54.379337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E20F20B0>]}
[0m01:24:54.489338 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:24:54.491837 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:24:54.515337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E2102B60>]}
[0m01:24:54.516337 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m01:24:54.516837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E2102B90>]}
[0m01:24:54.518838 [info ] [MainThread]: 
[0m01:24:54.519337 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:24:54.520337 [info ] [MainThread]: 
[0m01:24:54.520838 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:24:54.528338 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:24:54.529338 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:24:54.540837 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev'
[0m01:24:54.658339 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:24:54.658838 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:24:54.659341 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev"
[0m01:24:54.659841 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:24:54.660338 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:24:54.660841 [debug] [ThreadPool]: On list_dbt_hol_2025_dev: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev"} */
show terse schemas in database dbt_hol_2025_dev
    limit 10000
[0m01:24:54.661342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:54.661838 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:54.662339 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:55.142822 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.480 seconds
[0m01:24:55.143822 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.482 seconds
[0m01:24:55.155848 [debug] [ThreadPool]: SQL status: SUCCESS 5 in 0.494 seconds
[0m01:24:55.158847 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public'
[0m01:24:55.159846 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_02_intermediate'
[0m01:24:55.161348 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_03_marts'
[0m01:24:55.170846 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:24:55.171850 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_dev_public_01_staging'
[0m01:24:55.174345 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:24:55.176915 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:24:55.177416 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
show objects in dbt_hol_2025_dev.public limit 10000;
[0m01:24:55.179918 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:24:55.180418 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
show objects in dbt_hol_2025_dev.public_02_intermediate limit 10000;
[0m01:24:55.180915 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
show objects in dbt_hol_2025_dev.public_03_marts limit 10000;
[0m01:24:55.181914 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:55.182418 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
show objects in dbt_hol_2025_dev.public_01_staging limit 10000;
[0m01:24:55.182918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:55.183415 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:55.183914 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:24:55.583591 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.401 seconds
[0m01:24:55.584591 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_02_intermediate"
[0m01:24:55.585091 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:24:55.592576 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.409 seconds
[0m01:24:55.593076 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_03_marts"
[0m01:24:55.594079 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:24:55.594579 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.413 seconds
[0m01:24:55.595578 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public"
[0m01:24:55.596081 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:24:55.683722 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.500 seconds
[0m01:24:55.684709 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_dev_public_01_staging"
[0m01:24:55.685209 [debug] [ThreadPool]: On list_dbt_hol_2025_dev_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "connection_name": "list_dbt_hol_2025_dev_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:24:57.122051 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.527 seconds
[0m01:24:57.130240 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 1.533 seconds
[0m01:24:57.172786 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.587 seconds
[0m01:24:57.218144 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 1.532 seconds
[0m01:24:57.222145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E20CAC50>]}
[0m01:24:57.226644 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m01:24:57.227144 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m01:24:57.227144 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m01:24:57.227645 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m01:24:57.228644 [info ] [Thread-1 (]: 1 of 11 START sql table model public_01_staging.stg_forex_metrics .............. [RUN]
[0m01:24:57.229147 [info ] [Thread-2 (]: 2 of 11 START sql table model public_01_staging.stg_stock_metrics .............. [RUN]
[0m01:24:57.230145 [info ] [Thread-3 (]: 3 of 11 START sql table model public_01_staging.stg_trading_books .............. [RUN]
[0m01:24:57.230644 [info ] [Thread-4 (]: 4 of 11 START sql table model public_01_staging.stg_weights .................... [RUN]
[0m01:24:57.231645 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m01:24:57.232145 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m01:24:57.233145 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m01:24:57.233644 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m01:24:57.234145 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m01:24:57.234644 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m01:24:57.235144 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m01:24:57.235644 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m01:24:57.243645 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m01:24:57.246645 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m01:24:57.250146 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m01:24:57.252644 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m01:24:57.254644 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m01:24:57.255145 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m01:24:57.255145 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m01:24:57.268144 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m01:24:57.282144 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.stg_forex_metrics"
[0m01:24:57.285144 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.stg_stock_metrics"
[0m01:24:57.287867 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.stg_trading_books"
[0m01:24:57.290366 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.stg_weights"
[0m01:24:57.292867 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m01:24:57.293867 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m01:24:57.294366 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m01:24:57.294867 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_forex_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_forex_metrics
         as
        (with source as (
    select * from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.STOCK.FOREX_METRICS
),
renamed as (
    select
        run_date,
        currency_pair_name,
        open as open_rate,
        high as high_rate,
        low as low_rate,
        close as close_rate
    from source   
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:24:57.295866 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m01:24:57.296366 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_stock_metrics"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_stock_metrics
         as
        (with source as (
    select * from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.STOCK.US_STOCK_METRICS
),

renamed as (
    select
        run_date,
        ticker,
        open as open_price,
        high as high_price,
        low as low_price,
        close as close_price,
        volume
    from source
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:24:57.296867 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_trading_books"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_trading_books
         as
        (with source as (
    select * from dbt_hol_2025_dev.public.trading_books
),

renamed as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes
    from source
)

select * from renamed
        );
[0m01:24:57.297369 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:24:57.297867 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.stg_weights"} */
create or replace transient table dbt_hol_2025_dev.public_01_staging.stg_weights
         as
        (with source as (
    select *
    from dbt_hol_2025_dev.public.weights_table
),
renamed as (
    select region,
        desk,
        target_allocation
    from source
)
select *
from renamed
        );
[0m01:24:57.298366 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:24:57.299368 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:24:57.299867 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:24:58.597727 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.298 seconds
[0m01:24:58.621709 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E382B400>]}
[0m01:24:58.622709 [info ] [Thread-4 (]: 4 of 11 OK created sql table model public_01_staging.stg_weights ............... [[32mSUCCESS 1[0m in 1.39s]
[0m01:24:58.623691 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m01:24:58.734779 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.436 seconds
[0m01:24:58.737278 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E382AAD0>]}
[0m01:24:58.738278 [info ] [Thread-3 (]: 3 of 11 OK created sql table model public_01_staging.stg_trading_books ......... [[32mSUCCESS 1[0m in 1.50s]
[0m01:24:58.739296 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m01:24:58.740278 [debug] [Thread-4 (]: Began running node model.dbt_project.int_extracted_entities
[0m01:24:58.741280 [info ] [Thread-4 (]: 5 of 11 START sql table model public_02_intermediate.int_extracted_entities .... [RUN]
[0m01:24:58.741780 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now model.dbt_project.int_extracted_entities)
[0m01:24:58.742778 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m01:24:58.746278 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m01:24:58.748279 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_extracted_entities
[0m01:24:58.750279 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:24:58.751280 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
select current_warehouse() as warehouse
[0m01:24:58.813871 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.062 seconds
[0m01:24:58.815871 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:24:58.816372 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL
[0m01:24:58.900959 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m01:24:58.903446 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_extracted_entities"
[0m01:24:58.905760 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:24:58.906260 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
create or replace transient table dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
         as
        (-- with trading_books as (
--     select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
-- ),

-- -- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
-- cst as (
--     select
--         trade_id,
--         trade_date,
--         trader_name,
--         desk,
--         ticker,
--         quantity,
--         price,
--         trade_type,
--         notes,
--         SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
--         SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
--         SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
--     from trading_books
--     where notes is not null
-- )
-- select * from cst 



with trading_books as (
    select * from dbt_hol_2025_dev.public_01_staging.stg_trading_books
),

-- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
cst as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes,
        SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
        SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
        SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
    from trading_books
    where notes is not null
)

select * from cst
        );
[0m01:24:59.382064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.085 seconds
[0m01:24:59.384565 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E38B1120>]}
[0m01:24:59.385566 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_01_staging.stg_forex_metrics ......... [[32mSUCCESS 1[0m in 2.15s]
[0m01:24:59.386904 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m01:24:59.387887 [debug] [Thread-3 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m01:24:59.388880 [info ] [Thread-3 (]: 6 of 11 START sql dynamic_table model public_02_intermediate.int_fx_trade_pnl .. [RUN]
[0m01:24:59.389383 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now model.dbt_project.int_fx_trade_pnl)
[0m01:24:59.390383 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m01:24:59.394381 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m01:24:59.396381 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m01:24:59.398881 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:24:59.399380 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:24:59.477357 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.078 seconds
[0m01:24:59.479357 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:24:59.479857 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:24:59.562382 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.082 seconds
[0m01:24:59.581866 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:24:59.582867 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
show dynamic tables
            like 'INT_FX_TRADE_PNL'
            in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
        ;
[0m01:24:59.764900 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.182 seconds
[0m01:24:59.765902 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:24:59.766887 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
select
            "name",
            "schema_name",
            "database_name",
            "text",
            "target_lag",
            "warehouse",
            "refresh_mode"
        from table(result_scan(last_query_id()))
[0m01:25:00.226414 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.928 seconds
[0m01:25:00.228915 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E3886A10>]}
[0m01:25:00.229415 [info ] [Thread-2 (]: 2 of 11 OK created sql table model public_01_staging.stg_stock_metrics ......... [[32mSUCCESS 1[0m in 3.00s]
[0m01:25:00.230416 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m01:25:00.231415 [debug] [Thread-1 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m01:25:00.231915 [info ] [Thread-1 (]: 7 of 11 START sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [RUN]
[0m01:25:00.232415 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now model.dbt_project.int_equity_trade_pnl)
[0m01:25:00.232915 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m01:25:00.236415 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m01:25:00.237915 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m01:25:00.315917 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:00.317415 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.550 seconds
[0m01:25:00.317915 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:25:00.320916 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:25:00.321915 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
show iceberg tables
        like 'INT_FX_TRADE_PNL'
        in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
    ;
[0m01:25:00.401975 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m01:25:00.403974 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:00.404474 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:25:00.409974 [debug] [Thread-3 (]: SQL status: SUCCESS 0 in 0.087 seconds
[0m01:25:00.410486 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:25:00.410976 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
select
        "catalog_name",
        "external_volume_name",
        "base_location"
    from table(result_scan(last_query_id()))
[0m01:25:00.522884 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.117 seconds
[0m01:25:00.525372 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:00.525872 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
show dynamic tables
            like 'INT_EQUITY_TRADE_PNL'
            in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
        ;
[0m01:25:00.739723 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.213 seconds
[0m01:25:00.740721 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:00.741221 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
select
            "name",
            "schema_name",
            "database_name",
            "text",
            "target_lag",
            "warehouse",
            "refresh_mode"
        from table(result_scan(last_query_id()))
[0m01:25:00.939606 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.033 seconds
[0m01:25:00.941606 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:25:00.942615 [debug] [Thread-4 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:00.975816 [debug] [Thread-3 (]: SQL status: SUCCESS 0 in 0.564 seconds
[0m01:25:00.981816 [debug] [Thread-3 (]: Applying ALTER to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:25:00.982302 [debug] [Thread-3 (]: Applying UPDATE TARGET_LAG to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL"
[0m01:25:00.985802 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_fx_trade_pnl"
[0m01:25:00.987802 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:25:00.988301 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
alter dynamic table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_FX_TRADE_PNL" set
            target_lag = 'downstream'
[0m01:25:01.064801 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.122 seconds
[0m01:25:01.066301 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E382F820>]}
[0m01:25:01.067301 [info ] [Thread-4 (]: 5 of 11 OK created sql table model public_02_intermediate.int_extracted_entities  [[32mSUCCESS 1[0m in 2.32s]
[0m01:25:01.068301 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_extracted_entities
[0m01:25:01.069302 [debug] [Thread-2 (]: Began running node model.dbt_project.fct_trader_drivers
[0m01:25:01.069801 [info ] [Thread-2 (]: 8 of 11 START sql dynamic_table model public_03_marts.fct_trader_drivers ....... [RUN]
[0m01:25:01.070801 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now model.dbt_project.fct_trader_drivers)
[0m01:25:01.071301 [debug] [Thread-2 (]: Began compiling node model.dbt_project.fct_trader_drivers
[0m01:25:01.074801 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.fct_trader_drivers"
[0m01:25:01.076302 [debug] [Thread-2 (]: Began executing node model.dbt_project.fct_trader_drivers
[0m01:25:01.078305 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:01.078802 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
select current_warehouse() as warehouse
[0m01:25:01.188021 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.108 seconds
[0m01:25:01.189521 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:01.190020 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
use warehouse VWH_DBT_HOL
[0m01:25:01.197829 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.209 seconds
[0m01:25:01.199329 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:25:01.199829 [debug] [Thread-3 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:01.300367 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.100 seconds
[0m01:25:01.302367 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E39677F0>]}
[0m01:25:01.303371 [info ] [Thread-3 (]: 6 of 11 OK created sql dynamic_table model public_02_intermediate.int_fx_trade_pnl  [[32mSUCCESS 1[0m in 1.91s]
[0m01:25:01.304867 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.114 seconds
[0m01:25:01.305783 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m01:25:01.308781 [debug] [Thread-2 (]: Applying REPLACE to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS"
[0m01:25:01.318280 [debug] [Thread-2 (]: Applying CREATE BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS"
[0m01:25:01.323780 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS__dbt_backup"
[0m01:25:01.330280 [debug] [Thread-2 (]: Applying RENAME to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS"
[0m01:25:01.335280 [debug] [Thread-2 (]: Applying CREATE to: dbt_hol_2025_dev.public_03_marts.fct_trader_drivers
[0m01:25:01.342780 [debug] [Thread-2 (]: Applying DROP BACKUP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS"
[0m01:25:01.344780 [debug] [Thread-2 (]: Applying DROP to: "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS__dbt_backup"
[0m01:25:01.345781 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.fct_trader_drivers"
[0m01:25:01.348280 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:01.349281 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
-- get the standard backup name
    

    -- drop any pre-existing backup
    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS__dbt_backup" cascade

    

;
[0m01:25:01.355303 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.614 seconds
[0m01:25:01.357302 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:01.357802 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
show iceberg tables
        like 'INT_EQUITY_TRADE_PNL'
        in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
    ;
[0m01:25:01.436340 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m01:25:01.437345 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:01.438328 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
-- use `render` to ensure that the fully qualified name is used
    /*
    Rename or move a table to the new name.

    Args:
        relation: SnowflakeRelation - relation to be renamed
        new_name: Union[str, SnowflakeRelation] - new name for `relation`
            if providing a string, the default database/schema will be used if that string is just an identifier
            if providing a SnowflakeRelation, `render` will be used to produce a fully qualified name
    Returns: templated string
    */
    alter table "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS" rename to "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS__dbt_backup";
[0m01:25:01.441830 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.083 seconds
[0m01:25:01.442335 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:01.443329 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
select
        "catalog_name",
        "external_volume_name",
        "base_location"
    from table(result_scan(last_query_id()))
[0m01:25:01.535065 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m01:25:01.535565 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:01.536566 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
create dynamic table dbt_hol_2025_dev.public_03_marts.fct_trader_drivers
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = FULL

        initialize = ON_CREATE

        as (
            
with extracted_entities as (
    select * from dbt_hol_2025_dev.public_02_intermediate.int_extracted_entities
),

-- Calculate trade driver statistics by trader
trader_driver_stats as (
    select
        trader_name,
        trade_driver,
        count(*) as total_trades,
        array_agg(distinct signal[0]:"answer"::string) as signals_used
    from extracted_entities
    where trade_driver is not null
    group by 1, 2
),

-- Calculate total trades per trader for percentage calculation
trader_totals as (
    select
        trader_name,
        sum(total_trades) as total_trades
    from trader_driver_stats
    group by 1
),

-- Combine statistics with percentages
final_stats as (
    select
        tds.trader_name,
        tds.trade_driver,
        tds.total_trades,
        tds.signals_used,
        round(tds.total_trades * 100.0 / nullif(tt.total_trades, 0), 2) as driver_percentage
    from trader_driver_stats tds
    join trader_totals tt
        on tds.trader_name = tt.trader_name
)

select * from final_stats
order by trader_name, total_trades desc
        )

    

;
[0m01:25:01.945281 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.501 seconds
[0m01:25:01.947281 [debug] [Thread-1 (]: Applying ALTER to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:25:01.947783 [debug] [Thread-1 (]: Applying UPDATE TARGET_LAG to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL"
[0m01:25:01.948783 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.int_equity_trade_pnl"
[0m01:25:01.950781 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:01.951283 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
alter dynamic table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_EQUITY_TRADE_PNL" set
            target_lag = 'downstream'
[0m01:25:02.082068 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.130 seconds
[0m01:25:02.084066 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:25:02.084568 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:02.166362 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.081 seconds
[0m01:25:02.168362 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141BE233850>]}
[0m01:25:02.169363 [info ] [Thread-1 (]: 7 of 11 OK created sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [[32mSUCCESS 1[0m in 1.94s]
[0m01:25:02.170365 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m01:25:02.171364 [debug] [Thread-4 (]: Began running node model.dbt_project.int_trade_pnl
[0m01:25:02.172364 [info ] [Thread-4 (]: 9 of 11 START sql dynamic_table model public_02_intermediate.int_trade_pnl ..... [RUN]
[0m01:25:02.172865 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_trade_pnl)
[0m01:25:02.173863 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m01:25:02.178362 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m01:25:02.179863 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_trade_pnl
[0m01:25:02.182362 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:02.182864 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:25:02.254122 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.070 seconds
[0m01:25:02.256118 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:02.257121 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:25:02.368277 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.111 seconds
[0m01:25:02.370765 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:02.371765 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
show dynamic tables
            like 'INT_TRADE_PNL'
            in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
        ;
[0m01:25:02.534639 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.163 seconds
[0m01:25:02.535638 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:02.536139 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
select
            "name",
            "schema_name",
            "database_name",
            "text",
            "target_lag",
            "warehouse",
            "refresh_mode"
        from table(result_scan(last_query_id()))
[0m01:25:03.025591 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.489 seconds
[0m01:25:03.028091 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:03.028591 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
show iceberg tables
        like 'INT_TRADE_PNL'
        in schema DBT_HOL_2025_DEV.PUBLIC_02_INTERMEDIATE
    ;
[0m01:25:03.240408 [debug] [Thread-4 (]: SQL status: SUCCESS 0 in 0.211 seconds
[0m01:25:03.240908 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:03.241909 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
select
        "catalog_name",
        "external_volume_name",
        "base_location"
    from table(result_scan(last_query_id()))
[0m01:25:13.412168 [debug] [Thread-4 (]: SQL status: SUCCESS 0 in 10.170 seconds
[0m01:25:13.414167 [debug] [Thread-4 (]: Applying ALTER to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:25:13.414670 [debug] [Thread-4 (]: Applying UPDATE TARGET_LAG to: "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL"
[0m01:25:13.415668 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_trade_pnl"
[0m01:25:13.417169 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:13.417669 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
alter dynamic table "DBT_HOL_2025_DEV"."PUBLIC_02_INTERMEDIATE"."INT_TRADE_PNL" set
            target_lag = 'downstream'
[0m01:25:13.577333 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.159 seconds
[0m01:25:13.579318 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:25:13.579818 [debug] [Thread-4 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:13.663606 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m01:25:13.665606 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E25E3610>]}
[0m01:25:13.666606 [info ] [Thread-4 (]: 9 of 11 OK created sql dynamic_table model public_02_intermediate.int_trade_pnl  [[32mSUCCESS 1[0m in 11.49s]
[0m01:25:13.667606 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_trade_pnl
[0m01:25:13.668609 [debug] [Thread-1 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m01:25:13.669112 [info ] [Thread-1 (]: 10 of 11 START sql dynamic_table model public_03_marts.fct_pnl_by_desk ......... [RUN]
[0m01:25:13.670110 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_equity_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m01:25:13.670612 [debug] [Thread-1 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m01:25:13.674109 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m01:25:13.676110 [debug] [Thread-1 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m01:25:13.678109 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:13.679112 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
select current_warehouse() as warehouse
[0m01:25:13.755315 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 12.218 seconds
[0m01:25:13.756314 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:13.756814 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
-- get the standard backup name
    

    

    
        drop table if exists "DBT_HOL_2025_DEV"."PUBLIC_03_MARTS"."FCT_TRADER_DRIVERS__dbt_backup" cascade
[0m01:25:13.768449 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m01:25:13.769950 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:13.770451 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL
[0m01:25:13.864745 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m01:25:13.867245 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:13.867745 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
show dynamic tables
            like 'FCT_PNL_BY_DESK'
            in schema DBT_HOL_2025_DEV.PUBLIC_03_MARTS
        ;
[0m01:25:13.912568 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.155 seconds
[0m01:25:13.914568 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:25:13.915068 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_trader_drivers"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:14.004594 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.136 seconds
[0m01:25:14.005594 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:14.006094 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
select
            "name",
            "schema_name",
            "database_name",
            "text",
            "target_lag",
            "warehouse",
            "refresh_mode"
        from table(result_scan(last_query_id()))
[0m01:25:14.009093 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.093 seconds
[0m01:25:14.011093 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E2687F70>]}
[0m01:25:14.012134 [info ] [Thread-2 (]: 8 of 11 OK created sql dynamic_table model public_03_marts.fct_trader_drivers .. [[32mSUCCESS 1[0m in 12.94s]
[0m01:25:14.013595 [debug] [Thread-2 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m01:25:14.436490 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.430 seconds
[0m01:25:14.438989 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:14.439491 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
show iceberg tables
        like 'FCT_PNL_BY_DESK'
        in schema DBT_HOL_2025_DEV.PUBLIC_03_MARTS
    ;
[0m01:25:14.513129 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.073 seconds
[0m01:25:14.514126 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:14.514626 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
select
        "catalog_name",
        "external_volume_name",
        "base_location"
    from table(result_scan(last_query_id()))
[0m01:25:14.811687 [debug] [Thread-1 (]: SQL status: SUCCESS 0 in 0.296 seconds
[0m01:25:14.813687 [warn ] [Thread-1 (]: No configuration changes were identified on: `dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk`. Continuing.
[0m01:25:14.817172 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:25:14.817672 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:14.948794 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.130 seconds
[0m01:25:14.950294 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E25E0910>]}
[0m01:25:14.951294 [info ] [Thread-1 (]: 10 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_by_desk .... [[32mskip dbt_hol_2025_dev.public_03_marts.fct_pnl_by_desk[0m in 1.28s]
[0m01:25:14.952797 [debug] [Thread-1 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m01:25:14.953794 [debug] [Thread-4 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m01:25:14.954295 [info ] [Thread-4 (]: 11 of 11 START sql dynamic_table model public_03_marts.fct_pnl_vs_target ....... [RUN]
[0m01:25:14.955295 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_trade_pnl, now model.dbt_project.fct_pnl_vs_target)
[0m01:25:14.955796 [debug] [Thread-4 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m01:25:14.959796 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m01:25:14.961795 [debug] [Thread-4 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m01:25:14.964294 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:14.965296 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
select current_warehouse() as warehouse
[0m01:25:15.055954 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m01:25:15.057954 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:15.058454 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL
[0m01:25:15.148392 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.089 seconds
[0m01:25:15.152377 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:15.152877 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
show dynamic tables
            like 'FCT_PNL_VS_TARGET'
            in schema DBT_HOL_2025_DEV.PUBLIC_03_MARTS
        ;
[0m01:25:15.334921 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.181 seconds
[0m01:25:15.335921 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:15.336922 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
select
            "name",
            "schema_name",
            "database_name",
            "text",
            "target_lag",
            "warehouse",
            "refresh_mode"
        from table(result_scan(last_query_id()))
[0m01:25:15.994517 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.657 seconds
[0m01:25:15.996517 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:15.997516 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
show iceberg tables
        like 'FCT_PNL_VS_TARGET'
        in schema DBT_HOL_2025_DEV.PUBLIC_03_MARTS
    ;
[0m01:25:16.260741 [debug] [Thread-4 (]: SQL status: SUCCESS 0 in 0.263 seconds
[0m01:25:16.261241 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:16.261742 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
select
        "catalog_name",
        "external_volume_name",
        "base_location"
    from table(result_scan(last_query_id()))
[0m01:25:16.586265 [debug] [Thread-4 (]: SQL status: SUCCESS 0 in 0.324 seconds
[0m01:25:16.588265 [warn ] [Thread-4 (]: No configuration changes were identified on: `dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target`. Continuing.
[0m01:25:16.590250 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:25:16.591250 [debug] [Thread-4 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "dev", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL_DEV
[0m01:25:16.681588 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.090 seconds
[0m01:25:16.683588 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9158a8e2-fbad-4477-9be2-6cfcf661a989', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141BE233850>]}
[0m01:25:16.684588 [info ] [Thread-4 (]: 11 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_vs_target .. [[32mskip dbt_hol_2025_dev.public_03_marts.fct_pnl_vs_target[0m in 1.73s]
[0m01:25:16.686088 [debug] [Thread-4 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m01:25:16.687591 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:25:16.688087 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:25:16.688587 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:25:16.819382 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:25:16.819882 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:25:16.959986 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev' was left open.
[0m01:25:16.960987 [debug] [MainThread]: On list_dbt_hol_2025_dev: Close
[0m01:25:17.088517 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public' was left open.
[0m01:25:17.089016 [debug] [MainThread]: On list_dbt_hol_2025_dev_public: Close
[0m01:25:17.185213 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_02_intermediate' was left open.
[0m01:25:17.185713 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_02_intermediate: Close
[0m01:25:17.288820 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_03_marts' was left open.
[0m01:25:17.289320 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_03_marts: Close
[0m01:25:17.413858 [debug] [MainThread]: Connection 'list_dbt_hol_2025_dev_public_01_staging' was left open.
[0m01:25:17.414358 [debug] [MainThread]: On list_dbt_hol_2025_dev_public_01_staging: Close
[0m01:25:17.531002 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was left open.
[0m01:25:17.532002 [debug] [MainThread]: On model.dbt_project.fct_pnl_by_desk: Close
[0m01:25:17.664799 [debug] [MainThread]: Connection 'model.dbt_project.fct_trader_drivers' was left open.
[0m01:25:17.665298 [debug] [MainThread]: On model.dbt_project.fct_trader_drivers: Close
[0m01:25:17.774418 [debug] [MainThread]: Connection 'model.dbt_project.int_fx_trade_pnl' was left open.
[0m01:25:17.774918 [debug] [MainThread]: On model.dbt_project.int_fx_trade_pnl: Close
[0m01:25:17.881610 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was left open.
[0m01:25:17.882110 [debug] [MainThread]: On model.dbt_project.fct_pnl_vs_target: Close
[0m01:25:17.997485 [info ] [MainThread]: 
[0m01:25:17.998555 [info ] [MainThread]: Finished running 6 dynamic table models, 5 table models in 0 hours 0 minutes and 23.48 seconds (23.48s).
[0m01:25:18.001046 [debug] [MainThread]: Command end result
[0m01:25:18.029533 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:25:18.033033 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:25:18.041033 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m01:25:18.041534 [info ] [MainThread]: 
[0m01:25:18.042034 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:25:18.042534 [info ] [MainThread]: 
[0m01:25:18.043534 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m01:25:18.045033 [debug] [MainThread]: Command `dbt run` succeeded at 01:25:18.044533 after 25.77 seconds
[0m01:25:18.045533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141BFFFAE60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141E2157CD0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000141BEBB2800>]}
[0m01:25:18.046034 [debug] [MainThread]: Flushing usage events
[0m01:25:18.359745 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:27:41.009518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024489A6AE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002448A98A2F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002448A989540>]}


============================== 01:27:41.013017 | fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db ==============================
[0m01:27:41.013017 [info ] [MainThread]: Running with dbt=1.9.4
[0m01:27:41.014020 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt seed --target=prod', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:27:41.974520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB4E3580>]}
[0m01:27:42.046520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002448A471990>]}
[0m01:27:42.048020 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m01:27:42.425996 [debug] [MainThread]: checksum: 6d8301ed5f8f0471e249cbcc8805b42bc5f78a9b258cb4e5c4b012c6ace116b4, vars: {}, profile: , target: prod, version: 1.9.4
[0m01:27:42.609497 [info ] [MainThread]: Unable to do partial parsing because config vars, config profile, or config target have changed
[0m01:27:42.610500 [debug] [MainThread]: previous checksum: 6d8301ed5f8f0471e249cbcc8805b42bc5f78a9b258cb4e5c4b012c6ace116b4, current checksum: b5597158181700c50f5bc1c71fe28b37a6fb85633dc5323885263678b6bc782c
[0m01:27:42.610997 [info ] [MainThread]: Unable to do partial parsing because profile has changed
[0m01:27:42.611997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x000002448A4A7190>]}
[0m01:27:44.086001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244ACEA9C00>]}
[0m01:27:44.278504 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:27:44.281502 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:27:44.305502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244ABB03070>]}
[0m01:27:44.306503 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m01:27:44.307003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244ABB25D80>]}
[0m01:27:44.309006 [info ] [MainThread]: 
[0m01:27:44.309506 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m01:27:44.310004 [info ] [MainThread]: 
[0m01:27:44.311003 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:27:44.317004 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod'
[0m01:27:44.452003 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod"
[0m01:27:44.452506 [debug] [ThreadPool]: On list_dbt_hol_2025_prod: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod"} */
show terse schemas in database dbt_hol_2025_prod
    limit 10000
[0m01:27:44.453004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:45.088836 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.636 seconds
[0m01:27:45.092335 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public'
[0m01:27:45.093335 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_03_marts'
[0m01:27:45.100835 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_01_staging'
[0m01:27:45.104834 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public"
[0m01:27:45.105334 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_02_intermediate'
[0m01:27:45.107834 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_03_marts"
[0m01:27:45.110334 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_01_staging"
[0m01:27:45.110835 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public"} */
show objects in dbt_hol_2025_prod.public limit 10000;
[0m01:27:45.113334 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_02_intermediate"
[0m01:27:45.113835 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_03_marts"} */
show objects in dbt_hol_2025_prod.public_03_marts limit 10000;
[0m01:27:45.114333 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_01_staging"} */
show objects in dbt_hol_2025_prod.public_01_staging limit 10000;
[0m01:27:45.114834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:45.115335 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_02_intermediate"} */
show objects in dbt_hol_2025_prod.public_02_intermediate limit 10000;
[0m01:27:45.115834 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:45.116334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:45.116835 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:45.421819 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.307 seconds
[0m01:27:45.422818 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public"
[0m01:27:45.423319 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:27:45.556747 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb887-020d-0832-000d-306b0004b20e
[0m01:27:45.557252 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m01:27:45.558251 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m01:27:45.558747 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m01:27:45.565630 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb887-020d-0cc1-000d-306b0004935e
[0m01:27:45.566131 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m01:27:45.567132 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m01:27:45.567630 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m01:27:45.768129 [debug] [ThreadPool]: Snowflake adapter: Snowflake query id: 01bbb887-020d-083b-000d-306b0003ee56
[0m01:27:45.769130 [debug] [ThreadPool]: Snowflake adapter: Snowflake error: 002043 (02000): SQL compilation error:
Object does not exist, or operation cannot be performed.
[0m01:27:45.769628 [debug] [ThreadPool]: Snowflake adapter: Error running SQL: macro list_relations_without_caching
[0m01:27:45.770128 [debug] [ThreadPool]: Snowflake adapter: Rolling back transaction.
[0m01:27:46.257391 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.833 seconds
[0m01:27:46.260389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024489DA5210>]}
[0m01:27:46.265391 [debug] [Thread-1 (]: Began running node seed.dbt_project.trading_books
[0m01:27:46.265890 [debug] [Thread-2 (]: Began running node seed.dbt_project.weights_table
[0m01:27:46.266892 [info ] [Thread-1 (]: 1 of 2 START seed file public.trading_books .................................... [RUN]
[0m01:27:46.267389 [info ] [Thread-2 (]: 2 of 2 START seed file public.weights_table .................................... [RUN]
[0m01:27:46.268391 [debug] [Thread-1 (]: Acquiring new snowflake connection 'seed.dbt_project.trading_books'
[0m01:27:46.269389 [debug] [Thread-2 (]: Acquiring new snowflake connection 'seed.dbt_project.weights_table'
[0m01:27:46.269893 [debug] [Thread-1 (]: Began compiling node seed.dbt_project.trading_books
[0m01:27:46.270392 [debug] [Thread-2 (]: Began compiling node seed.dbt_project.weights_table
[0m01:27:46.270893 [debug] [Thread-1 (]: Began executing node seed.dbt_project.trading_books
[0m01:27:46.271392 [debug] [Thread-2 (]: Began executing node seed.dbt_project.weights_table
[0m01:27:46.305891 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m01:27:46.307389 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m01:27:46.307892 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.trading_books"} */
create table dbt_hol_2025_prod.public.trading_books (TRADE_ID integer,TRADE_DATE date,TRADER_NAME text,DESK text,TICKER text,QUANTITY integer,PRICE float8,TRADE_TYPE text,NOTES text)
[0m01:27:46.308389 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.weights_table"} */
create table dbt_hol_2025_prod.public.weights_table (REGION text,DESK text,TARGET_ALLOCATION float8)
[0m01:27:46.308892 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:27:46.309392 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:27:46.879449 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.570 seconds
[0m01:27:46.893947 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m01:27:46.894447 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.trading_books"} */
BEGIN
[0m01:27:46.912239 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.603 seconds
[0m01:27:46.913739 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m01:27:46.914239 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.weights_table"} */
BEGIN
[0m01:27:47.024315 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.129 seconds
[0m01:27:47.026316 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m01:27:47.026815 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.trading_books"} */
insert into dbt_hol_2025_prod.public.trading_books (TRADE_ID, TRADE_DATE, TRADER_NAME, DESK, TICKER, QUANTITY, PRICE, TRADE_TYPE, NOTES) values
            (%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s,%s,%s,%s,%s,%s,%s),(%s,%s,%s...
[0m01:27:47.056451 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.141 seconds
[0m01:27:47.057451 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m01:27:47.057951 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.weights_table"} */
insert into dbt_hol_2025_prod.public.weights_table (REGION, DESK, TARGET_ALLOCATION) values
            (%s,%s,%s),(%s,%s,%s)...
[0m01:27:47.683158 [debug] [Thread-1 (]: SQL status: SUCCESS 30 in 0.655 seconds
[0m01:27:47.683657 [debug] [Thread-1 (]: Using snowflake connection "seed.dbt_project.trading_books"
[0m01:27:47.684657 [debug] [Thread-1 (]: On seed.dbt_project.trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.trading_books"} */
COMMIT
[0m01:27:47.734706 [debug] [Thread-2 (]: SQL status: SUCCESS 2 in 0.676 seconds
[0m01:27:47.735701 [debug] [Thread-2 (]: Using snowflake connection "seed.dbt_project.weights_table"
[0m01:27:47.736209 [debug] [Thread-2 (]: On seed.dbt_project.weights_table: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "seed.dbt_project.weights_table"} */
COMMIT
[0m01:27:47.994622 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.310 seconds
[0m01:27:48.000620 [debug] [Thread-1 (]: Writing runtime SQL for node "seed.dbt_project.trading_books"
[0m01:27:48.024619 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB8FB490>]}
[0m01:27:48.025620 [info ] [Thread-1 (]: 1 of 2 OK loaded seed file public.trading_books ................................ [[32mINSERT 30[0m in 1.75s]
[0m01:27:48.026649 [debug] [Thread-1 (]: Finished running node seed.dbt_project.trading_books
[0m01:27:48.233001 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.496 seconds
[0m01:27:48.234001 [debug] [Thread-2 (]: Writing runtime SQL for node "seed.dbt_project.weights_table"
[0m01:27:48.237001 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fd1d61dc-3d2e-4eeb-bcc9-30ad476d45db', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB8F8190>]}
[0m01:27:48.237501 [info ] [Thread-2 (]: 2 of 2 OK loaded seed file public.weights_table ................................ [[32mINSERT 2[0m in 1.97s]
[0m01:27:48.238503 [debug] [Thread-2 (]: Finished running node seed.dbt_project.weights_table
[0m01:27:48.240002 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:27:48.240502 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod' was left open.
[0m01:27:48.241001 [debug] [MainThread]: On list_dbt_hol_2025_prod: Close
[0m01:27:48.346267 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public' was left open.
[0m01:27:48.346765 [debug] [MainThread]: On list_dbt_hol_2025_prod_public: Close
[0m01:27:48.452033 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_03_marts' was left open.
[0m01:27:48.452534 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_03_marts: Close
[0m01:27:48.565533 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_01_staging' was left open.
[0m01:27:48.566033 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_01_staging: Close
[0m01:27:48.716886 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_02_intermediate' was left open.
[0m01:27:48.717886 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_02_intermediate: Close
[0m01:27:48.842722 [debug] [MainThread]: Connection 'seed.dbt_project.trading_books' was left open.
[0m01:27:48.843722 [debug] [MainThread]: On seed.dbt_project.trading_books: Close
[0m01:27:48.940758 [debug] [MainThread]: Connection 'seed.dbt_project.weights_table' was left open.
[0m01:27:48.941260 [debug] [MainThread]: On seed.dbt_project.weights_table: Close
[0m01:27:49.062712 [info ] [MainThread]: 
[0m01:27:49.063715 [info ] [MainThread]: Finished running 2 seeds in 0 hours 0 minutes and 4.75 seconds (4.75s).
[0m01:27:49.064713 [debug] [MainThread]: Command end result
[0m01:27:49.091714 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:27:49.094712 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:27:49.101713 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m01:27:49.102212 [info ] [MainThread]: 
[0m01:27:49.102712 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:27:49.103715 [info ] [MainThread]: 
[0m01:27:49.104214 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m01:27:49.105712 [debug] [MainThread]: Command `dbt seed` succeeded at 01:27:49.105712 after 8.21 seconds
[0m01:27:49.106215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024489A6AE90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000024489D50D90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x00000244AB9060E0>]}
[0m01:27:49.106713 [debug] [MainThread]: Flushing usage events
[0m01:27:49.386776 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:27:51.681750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED7E76E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED8D962F0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED8D95540>]}


============================== 01:27:51.685249 | e0e9a7fe-b150-446b-9365-f28627c18617 ==============================
[0m01:27:51.685249 [info ] [MainThread]: Running with dbt=1.9.4
[0m01:27:51.686251 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': 'C:\\Users\\tlee\\Downloads\\snowflake\\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\\dbt_project\\logs', 'profiles_dir': 'C:\\Users\\tlee\\.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --target=prod', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:27:52.651754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EF98234F0>]}
[0m01:27:52.724252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED81C0490>]}
[0m01:27:52.725752 [info ] [MainThread]: Registered adapter: snowflake=1.9.2
[0m01:27:53.104755 [debug] [MainThread]: checksum: 6d8301ed5f8f0471e249cbcc8805b42bc5f78a9b258cb4e5c4b012c6ace116b4, vars: {}, profile: , target: prod, version: 1.9.4
[0m01:27:53.397754 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:27:53.398254 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:27:53.460256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EF9DDC130>]}
[0m01:27:53.577755 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:27:53.581257 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:27:53.607756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EF9843F40>]}
[0m01:27:53.608757 [info ] [MainThread]: Found 11 models, 2 seeds, 10 data tests, 4 sources, 475 macros
[0m01:27:53.609256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EF98436D0>]}
[0m01:27:53.611755 [info ] [MainThread]: 
[0m01:27:53.612759 [info ] [MainThread]: Concurrency: 4 threads (target='prod')
[0m01:27:53.613258 [info ] [MainThread]: 
[0m01:27:53.614256 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m01:27:53.620758 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod'
[0m01:27:53.621757 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod'
[0m01:27:53.635760 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod'
[0m01:27:53.756255 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod"
[0m01:27:53.756755 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod"
[0m01:27:53.757255 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod"
[0m01:27:53.757756 [debug] [ThreadPool]: On list_dbt_hol_2025_prod: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod"} */
show terse schemas in database dbt_hol_2025_prod
    limit 10000
[0m01:27:53.758256 [debug] [ThreadPool]: On list_dbt_hol_2025_prod: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod"} */
show terse schemas in database dbt_hol_2025_prod
    limit 10000
[0m01:27:53.758755 [debug] [ThreadPool]: On list_dbt_hol_2025_prod: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod"} */
show terse schemas in database dbt_hol_2025_prod
    limit 10000
[0m01:27:53.759255 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:53.760261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:53.760756 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:54.281221 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.521 seconds
[0m01:27:54.282222 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.522 seconds
[0m01:27:54.291821 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.532 seconds
[0m01:27:54.293820 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_prod, now create_dbt_hol_2025_prod_public_03_marts)
[0m01:27:54.294322 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_prod, now create_dbt_hol_2025_prod_public_01_staging)
[0m01:27:54.294826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_dbt_hol_2025_prod, now create_dbt_hol_2025_prod_public_02_intermediate)
[0m01:27:54.295821 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_prod"
schema: "public_03_marts"
"
[0m01:27:54.296320 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_prod"
schema: "public_01_staging"
"
[0m01:27:54.297320 [debug] [ThreadPool]: Creating schema "database: "dbt_hol_2025_prod"
schema: "public_02_intermediate"
"
[0m01:27:54.302820 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_prod_public_03_marts"
[0m01:27:54.304820 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_prod_public_01_staging"
[0m01:27:54.307320 [debug] [ThreadPool]: Using snowflake connection "create_dbt_hol_2025_prod_public_02_intermediate"
[0m01:27:54.307820 [debug] [ThreadPool]: On create_dbt_hol_2025_prod_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "create_dbt_hol_2025_prod_public_03_marts"} */
create schema if not exists dbt_hol_2025_prod.public_03_marts
[0m01:27:54.308320 [debug] [ThreadPool]: On create_dbt_hol_2025_prod_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "create_dbt_hol_2025_prod_public_01_staging"} */
create schema if not exists dbt_hol_2025_prod.public_01_staging
[0m01:27:54.308820 [debug] [ThreadPool]: On create_dbt_hol_2025_prod_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "create_dbt_hol_2025_prod_public_02_intermediate"} */
create schema if not exists dbt_hol_2025_prod.public_02_intermediate
[0m01:27:54.448457 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.138 seconds
[0m01:27:54.513182 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.204 seconds
[0m01:27:54.516272 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.207 seconds
[0m01:27:54.519683 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public'
[0m01:27:54.520683 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_03_marts'
[0m01:27:54.530680 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public"
[0m01:27:54.531180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_01_staging'
[0m01:27:54.532180 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_dbt_hol_2025_prod_public_02_intermediate'
[0m01:27:54.535679 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_03_marts"
[0m01:27:54.536182 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public"} */
show objects in dbt_hol_2025_prod.public limit 10000;
[0m01:27:54.538679 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_01_staging"
[0m01:27:54.541180 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_02_intermediate"
[0m01:27:54.541679 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_03_marts"} */
show objects in dbt_hol_2025_prod.public_03_marts limit 10000;
[0m01:27:54.542684 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:54.543181 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_01_staging"} */
show objects in dbt_hol_2025_prod.public_01_staging limit 10000;
[0m01:27:54.543679 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_02_intermediate"} */
show objects in dbt_hol_2025_prod.public_02_intermediate limit 10000;
[0m01:27:54.544180 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:54.544682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:54.546683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:27:54.950308 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.406 seconds
[0m01:27:54.951310 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_01_staging"
[0m01:27:54.951809 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_01_staging: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_01_staging"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:27:54.954312 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.411 seconds
[0m01:27:54.955311 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_03_marts"
[0m01:27:54.955811 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_03_marts: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_03_marts"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:27:54.986826 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.440 seconds
[0m01:27:54.987826 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public_02_intermediate"
[0m01:27:54.988326 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public_02_intermediate: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public_02_intermediate"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:27:55.011827 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.469 seconds
[0m01:27:55.012326 [debug] [ThreadPool]: Using snowflake connection "list_dbt_hol_2025_prod_public"
[0m01:27:55.013326 [debug] [ThreadPool]: On list_dbt_hol_2025_prod_public: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "connection_name": "list_dbt_hol_2025_prod_public"} */
select all_objects.*, is_iceberg
      from table(result_scan(last_query_id(-1))) all_objects
      left join INFORMATION_SCHEMA.tables as all_tables
        on all_tables.table_name = all_objects."name"
        and all_tables.table_schema = all_objects."schema_name"
        and all_tables.table_catalog = all_objects."database_name"
[0m01:27:55.904799 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.891 seconds
[0m01:27:55.968830 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.980 seconds
[0m01:27:56.026126 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.074 seconds
[0m01:27:56.052354 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 1.096 seconds
[0m01:27:56.055353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFA261E10>]}
[0m01:27:56.060750 [debug] [Thread-1 (]: Began running node model.dbt_project.stg_forex_metrics
[0m01:27:56.061248 [debug] [Thread-2 (]: Began running node model.dbt_project.stg_stock_metrics
[0m01:27:56.061752 [debug] [Thread-3 (]: Began running node model.dbt_project.stg_trading_books
[0m01:27:56.062251 [debug] [Thread-4 (]: Began running node model.dbt_project.stg_weights
[0m01:27:56.062748 [info ] [Thread-1 (]: 1 of 11 START sql table model public_01_staging.stg_forex_metrics .............. [RUN]
[0m01:27:56.063750 [info ] [Thread-2 (]: 2 of 11 START sql table model public_01_staging.stg_stock_metrics .............. [RUN]
[0m01:27:56.064750 [info ] [Thread-3 (]: 3 of 11 START sql table model public_01_staging.stg_trading_books .............. [RUN]
[0m01:27:56.065751 [info ] [Thread-4 (]: 4 of 11 START sql table model public_01_staging.stg_weights .................... [RUN]
[0m01:27:56.066750 [debug] [Thread-1 (]: Acquiring new snowflake connection 'model.dbt_project.stg_forex_metrics'
[0m01:27:56.067248 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.dbt_project.stg_stock_metrics'
[0m01:27:56.068253 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.dbt_project.stg_trading_books'
[0m01:27:56.068751 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.dbt_project.stg_weights'
[0m01:27:56.069248 [debug] [Thread-1 (]: Began compiling node model.dbt_project.stg_forex_metrics
[0m01:27:56.069748 [debug] [Thread-2 (]: Began compiling node model.dbt_project.stg_stock_metrics
[0m01:27:56.070754 [debug] [Thread-3 (]: Began compiling node model.dbt_project.stg_trading_books
[0m01:27:56.071251 [debug] [Thread-4 (]: Began compiling node model.dbt_project.stg_weights
[0m01:27:56.078248 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.stg_forex_metrics"
[0m01:27:56.081748 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.stg_stock_metrics"
[0m01:27:56.086252 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.stg_trading_books"
[0m01:27:56.088748 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.stg_weights"
[0m01:27:56.090248 [debug] [Thread-1 (]: Began executing node model.dbt_project.stg_forex_metrics
[0m01:27:56.090751 [debug] [Thread-2 (]: Began executing node model.dbt_project.stg_stock_metrics
[0m01:27:56.091250 [debug] [Thread-3 (]: Began executing node model.dbt_project.stg_trading_books
[0m01:27:56.117748 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.stg_forex_metrics"
[0m01:27:56.118248 [debug] [Thread-4 (]: Began executing node model.dbt_project.stg_weights
[0m01:27:56.120748 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.stg_stock_metrics"
[0m01:27:56.123752 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.stg_trading_books"
[0m01:27:56.126248 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.stg_weights"
[0m01:27:56.127750 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.stg_forex_metrics"
[0m01:27:56.128752 [debug] [Thread-1 (]: On model.dbt_project.stg_forex_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.stg_forex_metrics"} */
create or replace transient table dbt_hol_2025_prod.public_01_staging.stg_forex_metrics
         as
        (with source as (
    select * from FOREX_TRACKING_CURRENCY_EXCHANGE_RATES_BY_DAY.STOCK.FOREX_METRICS
),
renamed as (
    select
        run_date,
        currency_pair_name,
        open as open_rate,
        high as high_rate,
        low as low_rate,
        close as close_rate
    from source   
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:27:56.129252 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.stg_stock_metrics"
[0m01:27:56.130250 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.stg_trading_books"
[0m01:27:56.130751 [debug] [Thread-1 (]: Opening a new connection, currently in state init
[0m01:27:56.132249 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.stg_weights"
[0m01:27:56.132749 [debug] [Thread-2 (]: On model.dbt_project.stg_stock_metrics: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.stg_stock_metrics"} */
create or replace transient table dbt_hol_2025_prod.public_01_staging.stg_stock_metrics
         as
        (with source as (
    select * from STOCK_TRACKING_US_STOCK_PRICES_BY_DAY.STOCK.US_STOCK_METRICS
),

renamed as (
    select
        run_date,
        ticker,
        open as open_price,
        high as high_price,
        low as low_price,
        close as close_price,
        volume
    from source
)

select * from renamed 
where 1=1 
  AND run_date >= '2024-01-01'
        );
[0m01:27:56.133249 [debug] [Thread-3 (]: On model.dbt_project.stg_trading_books: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.stg_trading_books"} */
create or replace transient table dbt_hol_2025_prod.public_01_staging.stg_trading_books
         as
        (with source as (
    select * from dbt_hol_2025_prod.public.trading_books
),

renamed as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes
    from source
)

select * from renamed
        );
[0m01:27:56.134250 [debug] [Thread-4 (]: On model.dbt_project.stg_weights: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.stg_weights"} */
create or replace transient table dbt_hol_2025_prod.public_01_staging.stg_weights
         as
        (with source as (
    select *
    from dbt_hol_2025_prod.public.weights_table
),
renamed as (
    select region,
        desk,
        target_allocation
    from source
)
select *
from renamed
        );
[0m01:27:56.136248 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:27:56.137252 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:27:56.138249 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:27:57.227047 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.089 seconds
[0m01:27:57.246553 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED55E9BD0>]}
[0m01:27:57.247547 [info ] [Thread-3 (]: 3 of 11 OK created sql table model public_01_staging.stg_trading_books ......... [[32mSUCCESS 1[0m in 1.18s]
[0m01:27:57.249048 [debug] [Thread-3 (]: Finished running node model.dbt_project.stg_trading_books
[0m01:27:57.249547 [debug] [Thread-3 (]: Began running node model.dbt_project.int_extracted_entities
[0m01:27:57.250547 [info ] [Thread-3 (]: 5 of 11 START sql table model public_02_intermediate.int_extracted_entities .... [RUN]
[0m01:27:57.251047 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_trading_books, now model.dbt_project.int_extracted_entities)
[0m01:27:57.251547 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_extracted_entities
[0m01:27:57.255047 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_extracted_entities"
[0m01:27:57.256547 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_extracted_entities
[0m01:27:57.258547 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:27:57.259047 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_extracted_entities"} */
select current_warehouse() as warehouse
[0m01:27:57.321892 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.062 seconds
[0m01:27:57.323892 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:27:57.324394 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL
[0m01:27:57.387752 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.250 seconds
[0m01:27:57.390251 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB408760>]}
[0m01:27:57.390752 [info ] [Thread-4 (]: 4 of 11 OK created sql table model public_01_staging.stg_weights ............... [[32mSUCCESS 1[0m in 1.32s]
[0m01:27:57.392248 [debug] [Thread-4 (]: Finished running node model.dbt_project.stg_weights
[0m01:27:57.464294 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.139 seconds
[0m01:27:57.466272 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_extracted_entities"
[0m01:27:57.468768 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:27:57.469268 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_extracted_entities"} */
create or replace transient table dbt_hol_2025_prod.public_02_intermediate.int_extracted_entities
         as
        (-- with trading_books as (
--     select * from dbt_hol_2025_prod.public_01_staging.stg_trading_books
-- ),

-- -- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
-- cst as (
--     select
--         trade_id,
--         trade_date,
--         trader_name,
--         desk,
--         ticker,
--         quantity,
--         price,
--         trade_type,
--         notes,
--         SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
--         SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
--         SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
--     from trading_books
--     where notes is not null
-- )
-- select * from cst 



with trading_books as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_trading_books
),

-- Extract sentiment using SNOWFLAKE.CORTEX.SENTIMENT
cst as (
    select
        trade_id,
        trade_date,
        trader_name,
        desk,
        ticker,
        quantity,
        price,
        trade_type,
        notes,
        SNOWFLAKE.CORTEX.SENTIMENT(notes) as sentiment,
        SNOWFLAKE.CORTEX.EXTRACT_ANSWER(notes, 'What is the signal driving the following trade?') as signal,
        SNOWFLAKE.CORTEX.CLASSIFY_TEXT(notes||': '|| signal[0]:"answer"::string,['Market Signal','Execution Strategy']):"label"::string as trade_driver
    from trading_books
    where notes is not null
)

select * from cst
        );
[0m01:27:58.668881 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 2.538 seconds
[0m01:27:58.670881 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB38F400>]}
[0m01:27:58.671881 [info ] [Thread-1 (]: 1 of 11 OK created sql table model public_01_staging.stg_forex_metrics ......... [[32mSUCCESS 1[0m in 2.60s]
[0m01:27:58.672887 [debug] [Thread-1 (]: Finished running node model.dbt_project.stg_forex_metrics
[0m01:27:58.673881 [debug] [Thread-4 (]: Began running node model.dbt_project.int_fx_trade_pnl
[0m01:27:58.674380 [info ] [Thread-4 (]: 6 of 11 START sql dynamic_table model public_02_intermediate.int_fx_trade_pnl .. [RUN]
[0m01:27:58.675381 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_weights, now model.dbt_project.int_fx_trade_pnl)
[0m01:27:58.675884 [debug] [Thread-4 (]: Began compiling node model.dbt_project.int_fx_trade_pnl
[0m01:27:58.679880 [debug] [Thread-4 (]: Writing injected SQL for node "model.dbt_project.int_fx_trade_pnl"
[0m01:27:58.681883 [debug] [Thread-4 (]: Began executing node model.dbt_project.int_fx_trade_pnl
[0m01:27:58.684880 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:27:58.685380 [debug] [Thread-4 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:27:58.753786 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.068 seconds
[0m01:27:58.755287 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:27:58.756288 [debug] [Thread-4 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:27:58.923403 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.166 seconds
[0m01:27:58.939403 [debug] [Thread-4 (]: Applying CREATE to: dbt_hol_2025_prod.public_02_intermediate.int_fx_trade_pnl
[0m01:27:58.949904 [debug] [Thread-4 (]: Writing runtime sql for node "model.dbt_project.int_fx_trade_pnl"
[0m01:27:58.955403 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:27:58.956405 [debug] [Thread-4 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
create dynamic table dbt_hol_2025_prod.public_02_intermediate.int_fx_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trading_books as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_trading_books
    where desk = 'FX Desk'
),

forex_metrics as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_forex_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        -- and b1.trade_date <= b2.trade_date
        and b1.trade_date = b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        f.close_rate,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity * f.close_rate as pnl_usd
    from matched_trades m
    -- left join forex_metrics f
    join forex_metrics f
        on m.ticker = f.currency_pair_name
        and m.sell_date = f.run_date
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        f.open_rate as day_open,
        f.close_rate as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((f.open_rate - t.price) / f.open_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((f.close_rate - t.price) / f.close_rate) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - f.close_rate) / f.close_rate) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((f.close_rate - f.open_rate) / f.open_rate) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate then 'Better than open'
                    when t.price > f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate then 'Better than open'
                    when t.price < f.open_rate then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.close_rate then 'Better than close'
                    when t.price > f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.close_rate then 'Better than close'
                    when t.price < f.close_rate then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then 'Best price of day'
                    when t.price > f.open_rate and t.price > f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then 'Best price of day'
                    when t.price < f.open_rate and t.price < f.close_rate then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                    else
                        round(((f.close_rate - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > f.open_rate and t.price > f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    when t.price < f.open_rate and t.price < f.close_rate then
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                    else
                        round(((t.price - f.open_rate) / f.open_rate) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join forex_metrics f
    join forex_metrics f
        on t.ticker = f.currency_pair_name
        and t.trade_date = f.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        )
[0m01:27:59.233056 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.097 seconds
[0m01:27:59.235554 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB409D50>]}
[0m01:27:59.236556 [info ] [Thread-2 (]: 2 of 11 OK created sql table model public_01_staging.stg_stock_metrics ......... [[32mSUCCESS 1[0m in 3.17s]
[0m01:27:59.238056 [debug] [Thread-2 (]: Finished running node model.dbt_project.stg_stock_metrics
[0m01:27:59.238828 [debug] [Thread-1 (]: Began running node model.dbt_project.int_equity_trade_pnl
[0m01:27:59.239346 [info ] [Thread-1 (]: 7 of 11 START sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [RUN]
[0m01:27:59.240345 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_forex_metrics, now model.dbt_project.int_equity_trade_pnl)
[0m01:27:59.240846 [debug] [Thread-1 (]: Began compiling node model.dbt_project.int_equity_trade_pnl
[0m01:27:59.244845 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.int_equity_trade_pnl"
[0m01:27:59.246845 [debug] [Thread-1 (]: Began executing node model.dbt_project.int_equity_trade_pnl
[0m01:27:59.249344 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:27:59.249845 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:27:59.330787 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.080 seconds
[0m01:27:59.332288 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:27:59.332783 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:27:59.434786 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.965 seconds
[0m01:27:59.436785 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_extracted_entities"
[0m01:27:59.437285 [debug] [Thread-3 (]: On model.dbt_project.int_extracted_entities: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_extracted_entities"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:27:59.534189 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m01:27:59.536192 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB40AF80>]}
[0m01:27:59.537192 [info ] [Thread-3 (]: 5 of 11 OK created sql table model public_02_intermediate.int_extracted_entities  [[32mSUCCESS 1[0m in 2.29s]
[0m01:27:59.538734 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_extracted_entities
[0m01:27:59.539232 [debug] [Thread-2 (]: Began running node model.dbt_project.fct_trader_drivers
[0m01:27:59.540232 [info ] [Thread-2 (]: 8 of 11 START sql dynamic_table model public_03_marts.fct_trader_drivers ....... [RUN]
[0m01:27:59.541219 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.stg_stock_metrics, now model.dbt_project.fct_trader_drivers)
[0m01:27:59.541719 [debug] [Thread-2 (]: Began compiling node model.dbt_project.fct_trader_drivers
[0m01:27:59.545719 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.fct_trader_drivers"
[0m01:27:59.547742 [debug] [Thread-2 (]: Began executing node model.dbt_project.fct_trader_drivers
[0m01:27:59.550222 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:27:59.551224 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_trader_drivers"} */
select current_warehouse() as warehouse
[0m01:27:59.635280 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.083 seconds
[0m01:27:59.636781 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:27:59.637782 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_trader_drivers"} */
use warehouse VWH_DBT_HOL
[0m01:27:59.732061 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.399 seconds
[0m01:27:59.733560 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.096 seconds
[0m01:27:59.735560 [debug] [Thread-1 (]: Applying CREATE to: dbt_hol_2025_prod.public_02_intermediate.int_equity_trade_pnl
[0m01:27:59.737060 [debug] [Thread-2 (]: Applying CREATE to: dbt_hol_2025_prod.public_03_marts.fct_trader_drivers
[0m01:27:59.738060 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.int_equity_trade_pnl"
[0m01:27:59.739562 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.fct_trader_drivers"
[0m01:27:59.742560 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:27:59.747060 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:27:59.747559 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_trader_drivers"} */
create dynamic table dbt_hol_2025_prod.public_03_marts.fct_trader_drivers
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = FULL

        initialize = ON_CREATE

        as (
            
with extracted_entities as (
    select * from dbt_hol_2025_prod.public_02_intermediate.int_extracted_entities
),

-- Calculate trade driver statistics by trader
trader_driver_stats as (
    select
        trader_name,
        trade_driver,
        count(*) as total_trades,
        array_agg(distinct signal[0]:"answer"::string) as signals_used
    from extracted_entities
    where trade_driver is not null
    group by 1, 2
),

-- Calculate total trades per trader for percentage calculation
trader_totals as (
    select
        trader_name,
        sum(total_trades) as total_trades
    from trader_driver_stats
    group by 1
),

-- Combine statistics with percentages
final_stats as (
    select
        tds.trader_name,
        tds.trade_driver,
        tds.total_trades,
        tds.signals_used,
        round(tds.total_trades * 100.0 / nullif(tt.total_trades, 0), 2) as driver_percentage
    from trader_driver_stats tds
    join trader_totals tt
        on tds.trader_name = tt.trader_name
)

select * from final_stats
order by trader_name, total_trades desc
        )
[0m01:27:59.748560 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
create dynamic table dbt_hol_2025_prod.public_02_intermediate.int_equity_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trading_books as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_trading_books
    where desk = 'Equity Desk'
),

stock_metrics as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_stock_metrics
),

-- Match BUY and SELL trades for the same ticker and trader
matched_trades as (
    select 
        b1.trade_id as buy_trade_id,
        b1.trade_date as buy_date,
        b1.trader_name,
        b1.desk,
        b1.ticker,
        b1.quantity,
        b1.price as buy_price,
        b2.trade_id as sell_trade_id,
        b2.trade_date as sell_date,
        b2.price as sell_price,
        b2.notes as sell_notes
    from trading_books b1
    join trading_books b2
        on b1.ticker = b2.ticker
        and b1.trader_name = b2.trader_name
        and b1.trade_type = 'BUY'
        and b2.trade_type = 'SELL'
        and b1.trade_date <= b2.trade_date
),

-- Calculate P&L for matched trades
matched_trades_pnl as (
    select
        m.*,
        (m.sell_price - m.buy_price) * m.quantity as pnl,
        (m.sell_price - m.buy_price) * m.quantity as pnl_usd  -- Same as pnl since already in USD
    from matched_trades m
),

-- Calculate P&L for individual trades
trade_pnl as (
    select
        t.trade_id,
        t.trade_date,
        t.trader_name,
        t.desk,
        t.ticker,
        t.quantity,
        t.price as trade_price,
        t.trade_type,
        t.notes,
        s.open_price as day_open,
        s.close_price as day_close,
        -- Calculate percentage differences from market prices
        case 
            when t.trade_type = 'BUY' then
                round(((s.open_price - t.price) / s.open_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.open_price) / s.open_price) * 100, 2)
        end as vs_open_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                round(((s.close_price - t.price) / s.close_price) * 100, 2)
            when t.trade_type = 'SELL' then
                round(((t.price - s.close_price) / s.close_price) * 100, 2)
        end as vs_close_performance_pct,
        -- Calculate overall market performance for the day
        round(((s.close_price - s.open_price) / s.open_price) * 100, 2) as market_daily_performance_pct,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price then 'Better than open'
                    when t.price > s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price then 'Better than open'
                    when t.price < s.open_price then 'Worse than open'
                    else 'Equal to open'
                end
        end as vs_open_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.close_price then 'Better than close'
                    when t.price > s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.close_price then 'Better than close'
                    when t.price < s.close_price then 'Worse than close'
                    else 'Equal to close'
                end
        end as vs_close_price,
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then 'Best price of day'
                    when t.price > s.open_price and t.price > s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then 'Best price of day'
                    when t.price < s.open_price and t.price < s.close_price then 'Worst price of day'
                    else 'Middle price of day'
                end
        end as price_performance,
        -- Calculate relative performance vs market
        case 
            when t.trade_type = 'BUY' then
                case
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                    else
                        round(((s.close_price - t.price) / t.price) * 100, 2)
                end
            when t.trade_type = 'SELL' then
                case
                    when t.price > s.open_price and t.price > s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    when t.price < s.open_price and t.price < s.close_price then
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                    else
                        round(((t.price - s.open_price) / s.open_price) * 100, 2)
                end
        end as relative_performance_pct
    from trading_books t
    -- left join stock_metrics s
    join stock_metrics s
        on t.ticker = s.ticker
        and t.trade_date = s.run_date
)

-- Combine matched trades P&L with individual trade performance
select 
    t.*,
    m.pnl,
    m.pnl_usd,
    m.buy_trade_id,
    m.sell_trade_id,
    m.buy_date,
    m.sell_date,
    m.buy_price,
    m.sell_price,
    m.sell_notes
from trade_pnl t
-- left join matched_trades_pnl m
join matched_trades_pnl m
    on t.trade_id = m.buy_trade_id
    or t.trade_id = m.sell_trade_id
        )
[0m01:28:11.342585 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 11.593 seconds
[0m01:28:11.344586 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_trader_drivers"
[0m01:28:11.345085 [debug] [Thread-2 (]: On model.dbt_project.fct_trader_drivers: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_trader_drivers"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:11.419797 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m01:28:11.421797 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB4E3190>]}
[0m01:28:11.422797 [info ] [Thread-2 (]: 8 of 11 OK created sql dynamic_table model public_03_marts.fct_trader_drivers .. [[32mSUCCESS 1[0m in 11.88s]
[0m01:28:11.424297 [debug] [Thread-2 (]: Finished running node model.dbt_project.fct_trader_drivers
[0m01:28:11.530426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 11.781 seconds
[0m01:28:11.532425 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.int_equity_trade_pnl"
[0m01:28:11.532923 [debug] [Thread-1 (]: On model.dbt_project.int_equity_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_equity_trade_pnl"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:11.633027 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.099 seconds
[0m01:28:11.635026 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB515BD0>]}
[0m01:28:11.635527 [info ] [Thread-1 (]: 7 of 11 OK created sql dynamic_table model public_02_intermediate.int_equity_trade_pnl  [[32mSUCCESS 1[0m in 12.39s]
[0m01:28:11.636531 [debug] [Thread-1 (]: Finished running node model.dbt_project.int_equity_trade_pnl
[0m01:28:12.201988 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 13.245 seconds
[0m01:28:12.203488 [debug] [Thread-4 (]: Using snowflake connection "model.dbt_project.int_fx_trade_pnl"
[0m01:28:12.204490 [debug] [Thread-4 (]: On model.dbt_project.int_fx_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_fx_trade_pnl"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:12.336226 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.131 seconds
[0m01:28:12.338226 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB3EC9A0>]}
[0m01:28:12.339230 [info ] [Thread-4 (]: 6 of 11 OK created sql dynamic_table model public_02_intermediate.int_fx_trade_pnl  [[32mSUCCESS 1[0m in 13.66s]
[0m01:28:12.340728 [debug] [Thread-4 (]: Finished running node model.dbt_project.int_fx_trade_pnl
[0m01:28:12.341726 [debug] [Thread-3 (]: Began running node model.dbt_project.int_trade_pnl
[0m01:28:12.342227 [info ] [Thread-3 (]: 9 of 11 START sql dynamic_table model public_02_intermediate.int_trade_pnl ..... [RUN]
[0m01:28:12.343728 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_extracted_entities, now model.dbt_project.int_trade_pnl)
[0m01:28:12.344228 [debug] [Thread-3 (]: Began compiling node model.dbt_project.int_trade_pnl
[0m01:28:12.348726 [debug] [Thread-3 (]: Writing injected SQL for node "model.dbt_project.int_trade_pnl"
[0m01:28:12.350228 [debug] [Thread-3 (]: Began executing node model.dbt_project.int_trade_pnl
[0m01:28:12.352726 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:28:12.353228 [debug] [Thread-3 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_trade_pnl"} */
select current_warehouse() as warehouse
[0m01:28:12.496095 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.142 seconds
[0m01:28:12.497595 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:28:12.498095 [debug] [Thread-3 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL
[0m01:28:12.618002 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.119 seconds
[0m01:28:12.620003 [debug] [Thread-3 (]: Applying CREATE to: dbt_hol_2025_prod.public_02_intermediate.int_trade_pnl
[0m01:28:12.621003 [debug] [Thread-3 (]: Writing runtime sql for node "model.dbt_project.int_trade_pnl"
[0m01:28:12.623503 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:28:12.624003 [debug] [Thread-3 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_trade_pnl"} */
create dynamic table dbt_hol_2025_prod.public_02_intermediate.int_trade_pnl
        target_lag = 'downstream'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with equity_trades as (
    select * from dbt_hol_2025_prod.public_02_intermediate.int_equity_trade_pnl
),

fx_trades as (
    select * from dbt_hol_2025_prod.public_02_intermediate.int_fx_trade_pnl
)

select * from equity_trades
union all
select * from fx_trades
        )
[0m01:28:16.143161 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 3.518 seconds
[0m01:28:16.145149 [debug] [Thread-3 (]: Using snowflake connection "model.dbt_project.int_trade_pnl"
[0m01:28:16.145657 [debug] [Thread-3 (]: On model.dbt_project.int_trade_pnl: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.int_trade_pnl"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:16.269009 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.123 seconds
[0m01:28:16.271493 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB3EC9A0>]}
[0m01:28:16.271993 [info ] [Thread-3 (]: 9 of 11 OK created sql dynamic_table model public_02_intermediate.int_trade_pnl  [[32mSUCCESS 1[0m in 3.93s]
[0m01:28:16.273131 [debug] [Thread-3 (]: Finished running node model.dbt_project.int_trade_pnl
[0m01:28:16.274140 [debug] [Thread-1 (]: Began running node model.dbt_project.fct_pnl_by_desk
[0m01:28:16.274627 [info ] [Thread-1 (]: 10 of 11 START sql dynamic_table model public_03_marts.fct_pnl_by_desk ......... [RUN]
[0m01:28:16.275617 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dbt_project.int_equity_trade_pnl, now model.dbt_project.fct_pnl_by_desk)
[0m01:28:16.276117 [debug] [Thread-1 (]: Began compiling node model.dbt_project.fct_pnl_by_desk
[0m01:28:16.279117 [debug] [Thread-1 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_by_desk"
[0m01:28:16.280617 [debug] [Thread-1 (]: Began executing node model.dbt_project.fct_pnl_by_desk
[0m01:28:16.282617 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:28:16.283117 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
select current_warehouse() as warehouse
[0m01:28:16.357760 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.074 seconds
[0m01:28:16.359261 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:28:16.359760 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL
[0m01:28:16.444721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.084 seconds
[0m01:28:16.446707 [debug] [Thread-1 (]: Applying CREATE to: dbt_hol_2025_prod.public_03_marts.fct_pnl_by_desk
[0m01:28:16.447708 [debug] [Thread-1 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_by_desk"
[0m01:28:16.451205 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:28:16.452219 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
create dynamic table dbt_hol_2025_prod.public_03_marts.fct_pnl_by_desk
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with trade_performance as (
    select * from dbt_hol_2025_prod.public_02_intermediate.int_trade_pnl
),

-- Calculate daily P&L metrics by desk and ticker
daily_desk_metrics as (
    select
        p.desk,
        p.ticker,
        p.sell_date as trade_date,
        case 
            when p.ticker like '%/%' then 'Europe'
            else 'North America'
        end as region,
        count(distinct p.buy_trade_id) as total_trades,
        sum(p.quantity) as total_quantity,
        sum(p.pnl_usd) as total_pnl_usd,
        avg(p.quantity) as avg_trade_size,
        avg(p.pnl_usd) as avg_pnl_usd,
        -- Add trading performance metrics
        avg(p.vs_open_performance_pct) as avg_vs_open_performance_pct,
        avg(p.vs_close_performance_pct) as avg_vs_close_performance_pct,
        avg(p.market_daily_performance_pct) as avg_market_performance_pct,
        avg(p.relative_performance_pct) as avg_relative_performance_pct,
        count(case when p.price_performance = 'Best price of day' then 1 end) as best_price_trades,
        count(case when p.price_performance = 'Worst price of day' then 1 end) as worst_price_trades,
        count(case when p.price_performance = 'Middle price of day' then 1 end) as middle_price_trades
    from trade_performance p
    where p.buy_trade_id is not null  -- Only include matched trades
    group by 1, 2, 3, 4
),

-- Calculate cumulative metrics
cumulative_metrics as (
    select
        desk,
        ticker,
        trade_date,
        region,
        total_trades,
        total_quantity,
        total_pnl_usd,
        avg_trade_size,
        avg_pnl_usd,
        avg_vs_open_performance_pct,
        avg_vs_close_performance_pct,
        avg_market_performance_pct,
        avg_relative_performance_pct,
        best_price_trades,
        worst_price_trades,
        middle_price_trades,
        sum(total_pnl_usd) over (partition by desk, ticker order by trade_date) as cumulative_pnl_usd
    from daily_desk_metrics
)

select * from cumulative_metrics
        )
[0m01:28:20.792379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.340 seconds
[0m01:28:20.794366 [debug] [Thread-1 (]: Using snowflake connection "model.dbt_project.fct_pnl_by_desk"
[0m01:28:20.794866 [debug] [Thread-1 (]: On model.dbt_project.fct_pnl_by_desk: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_by_desk"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:20.879962 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.085 seconds
[0m01:28:20.881962 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB57FDC0>]}
[0m01:28:20.882963 [info ] [Thread-1 (]: 10 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_by_desk .... [[32mSUCCESS 1[0m in 4.61s]
[0m01:28:20.884466 [debug] [Thread-1 (]: Finished running node model.dbt_project.fct_pnl_by_desk
[0m01:28:20.885463 [debug] [Thread-2 (]: Began running node model.dbt_project.fct_pnl_vs_target
[0m01:28:20.885966 [info ] [Thread-2 (]: 11 of 11 START sql dynamic_table model public_03_marts.fct_pnl_vs_target ....... [RUN]
[0m01:28:20.886962 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.dbt_project.fct_trader_drivers, now model.dbt_project.fct_pnl_vs_target)
[0m01:28:20.887462 [debug] [Thread-2 (]: Began compiling node model.dbt_project.fct_pnl_vs_target
[0m01:28:20.891462 [debug] [Thread-2 (]: Writing injected SQL for node "model.dbt_project.fct_pnl_vs_target"
[0m01:28:20.892963 [debug] [Thread-2 (]: Began executing node model.dbt_project.fct_pnl_vs_target
[0m01:28:20.895462 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:28:20.895962 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
select current_warehouse() as warehouse
[0m01:28:21.003284 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.107 seconds
[0m01:28:21.005285 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:28:21.005785 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL
[0m01:28:21.092801 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.086 seconds
[0m01:28:21.095302 [debug] [Thread-2 (]: Applying CREATE to: dbt_hol_2025_prod.public_03_marts.fct_pnl_vs_target
[0m01:28:21.097803 [debug] [Thread-2 (]: Writing runtime sql for node "model.dbt_project.fct_pnl_vs_target"
[0m01:28:21.101802 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:28:21.102801 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
create dynamic table dbt_hol_2025_prod.public_03_marts.fct_pnl_vs_target
        target_lag = '1 minute'
        warehouse = VWH_DBT_HOL
        refresh_mode = INCREMENTAL

        initialize = ON_CREATE

        as (
            with pnl_by_desk as (
    select * from dbt_hol_2025_prod.public_03_marts.fct_pnl_by_desk
),

weights as (
    select * from dbt_hol_2025_prod.public_01_staging.stg_weights
),

-- Calculate total portfolio value by desk and region
portfolio_value as (
    select
        trade_date,
        desk,
        region,
        sum(total_pnl_usd) as portfolio_value_usd,
        avg(avg_vs_open_performance_pct) as portfolio_vs_open_performance,
        avg(avg_vs_close_performance_pct) as portfolio_vs_close_performance,
        avg(avg_market_performance_pct) as portfolio_market_performance,
        avg(avg_relative_performance_pct) as portfolio_relative_performance,
        sum(best_price_trades) as total_best_price_trades,
        sum(worst_price_trades) as total_worst_price_trades,
        sum(middle_price_trades) as total_middle_price_trades
    from pnl_by_desk
    group by 1, 2, 3
),

-- Calculate total portfolio value across all desks and regions for each date
total_portfolio_value as (
    select
        trade_date,
        sum(portfolio_value_usd) as total_portfolio_value_usd
    from portfolio_value
    group by 1
),

-- Calculate actual allocations and compare with targets
allocation_variance as (
    select
        pv.trade_date,
        pv.desk,
        pv.region,
        w.target_allocation,
        pv.portfolio_value_usd,
        tp.total_portfolio_value_usd,
        pv.portfolio_vs_open_performance,
        pv.portfolio_vs_close_performance,
        pv.portfolio_market_performance,
        pv.portfolio_relative_performance,
        pv.total_best_price_trades,
        pv.total_worst_price_trades,
        pv.total_middle_price_trades,
        pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) as actual_allocation,
        (pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) - w.target_allocation) as allocation_variance,
        case
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) > w.target_allocation then 'Overweight'
            when pv.portfolio_value_usd / nullif(tp.total_portfolio_value_usd, 0) < w.target_allocation then 'Underweight'
            else 'On Target'
        end as allocation_status
    from portfolio_value pv
    join total_portfolio_value tp
        on pv.trade_date = tp.trade_date
    join weights w
        on pv.desk = w.desk
        and pv.region = w.region
)

select * from allocation_variance
        )
[0m01:28:25.515342 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.411 seconds
[0m01:28:25.517343 [debug] [Thread-2 (]: Using snowflake connection "model.dbt_project.fct_pnl_vs_target"
[0m01:28:25.517843 [debug] [Thread-2 (]: On model.dbt_project.fct_pnl_vs_target: /* {"app": "dbt", "dbt_version": "1.9.4", "profile_name": "dbt_project", "target_name": "prod", "node_id": "model.dbt_project.fct_pnl_vs_target"} */
use warehouse VWH_DBT_HOL_PROD
[0m01:28:25.624441 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.106 seconds
[0m01:28:25.626440 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0e9a7fe-b150-446b-9365-f28627c18617', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB5A8220>]}
[0m01:28:25.627441 [info ] [Thread-2 (]: 11 of 11 OK created sql dynamic_table model public_03_marts.fct_pnl_vs_target .. [[32mSUCCESS 1[0m in 4.74s]
[0m01:28:25.628442 [debug] [Thread-2 (]: Finished running node model.dbt_project.fct_pnl_vs_target
[0m01:28:25.630440 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:28:25.630940 [debug] [MainThread]: Connection 'create_dbt_hol_2025_prod_public_02_intermediate' was left open.
[0m01:28:25.631439 [debug] [MainThread]: On create_dbt_hol_2025_prod_public_02_intermediate: Close
[0m01:28:25.749571 [debug] [MainThread]: Connection 'create_dbt_hol_2025_prod_public_01_staging' was left open.
[0m01:28:25.750071 [debug] [MainThread]: On create_dbt_hol_2025_prod_public_01_staging: Close
[0m01:28:25.872594 [debug] [MainThread]: Connection 'create_dbt_hol_2025_prod_public_03_marts' was left open.
[0m01:28:25.873093 [debug] [MainThread]: On create_dbt_hol_2025_prod_public_03_marts: Close
[0m01:28:25.991148 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public' was left open.
[0m01:28:25.992148 [debug] [MainThread]: On list_dbt_hol_2025_prod_public: Close
[0m01:28:26.107648 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_03_marts' was left open.
[0m01:28:26.108148 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_03_marts: Close
[0m01:28:26.208148 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_01_staging' was left open.
[0m01:28:26.208648 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_01_staging: Close
[0m01:28:26.341149 [debug] [MainThread]: Connection 'list_dbt_hol_2025_prod_public_02_intermediate' was left open.
[0m01:28:26.342148 [debug] [MainThread]: On list_dbt_hol_2025_prod_public_02_intermediate: Close
[0m01:28:26.485649 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_by_desk' was left open.
[0m01:28:26.486150 [debug] [MainThread]: On model.dbt_project.fct_pnl_by_desk: Close
[0m01:28:26.585149 [debug] [MainThread]: Connection 'model.dbt_project.fct_pnl_vs_target' was left open.
[0m01:28:26.585649 [debug] [MainThread]: On model.dbt_project.fct_pnl_vs_target: Close
[0m01:28:26.683650 [debug] [MainThread]: Connection 'model.dbt_project.int_trade_pnl' was left open.
[0m01:28:26.684652 [debug] [MainThread]: On model.dbt_project.int_trade_pnl: Close
[0m01:28:27.350791 [debug] [MainThread]: Connection 'model.dbt_project.int_fx_trade_pnl' was left open.
[0m01:28:27.351790 [debug] [MainThread]: On model.dbt_project.int_fx_trade_pnl: Close
[0m01:28:27.468236 [info ] [MainThread]: 
[0m01:28:27.469237 [info ] [MainThread]: Finished running 6 dynamic table models, 5 table models in 0 hours 0 minutes and 33.85 seconds (33.85s).
[0m01:28:27.471742 [debug] [MainThread]: Command end result
[0m01:28:27.497737 [debug] [MainThread]: Wrote artifact WritableManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\manifest.json
[0m01:28:27.500738 [debug] [MainThread]: Wrote artifact SemanticManifest to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\semantic_manifest.json
[0m01:28:27.509237 [debug] [MainThread]: Wrote artifact RunExecutionResult to C:\Users\tlee\Downloads\snowflake\sfguide-deploying-pipelines-with-snowflake-and-dbt-labs\dbt_project\target\run_results.json
[0m01:28:27.510238 [info ] [MainThread]: 
[0m01:28:27.510737 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:28:27.511740 [info ] [MainThread]: 
[0m01:28:27.512238 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m01:28:27.513737 [debug] [MainThread]: Command `dbt run` succeeded at 01:28:27.513737 after 35.94 seconds
[0m01:28:27.514236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED7E76E90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013ED81F2E30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x0000013EFB4E3BE0>]}
[0m01:28:27.514738 [debug] [MainThread]: Flushing usage events
[0m01:28:27.821913 [debug] [MainThread]: An error was encountered while trying to flush usage events
